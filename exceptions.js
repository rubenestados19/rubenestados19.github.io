/*! scripts/tumblr/utils/exceptions.js */
!function(t,n){"use strict";function e(t,n,e,r){t.addEventListener?t.addEventListener(n,e,!!r):t.attachEvent&&t.attachEvent("on"+n,e,!!r)}function r(t){var n=decodeURIComponent(h.cookie).match(new RegExp(t+"=([^;]+)"));return n&&n.length>1?n[1]:null}function o(t,n){return"string"==typeof t&&t.length>n?[t.slice(0,n/2),"...",t.length-n,"...",t.slice(-n/2)].join(""):t}function i(){return((h.head||{}).innerHTML||"").indexOf("#missinge_button")!==-1}function a(t,n,e,i,a){try{if(n=o(n,300)||"",w.test(n)&&!L.test(n))return;if(a=I(o(a&&a.stack,1e3)||""),w.test(a)&&!L.test(a))return;N.push({path:(h.location||{}).pathname||"NO_LOCATION_OR_PATHNAME",msg:o(t,200)||"",url:n,ln:d(e,10)||-1,col:d(i,10)||-1,err:a,group:A("js_errors_web_a")("A",A("js_errors_web_b")("B","*")),logged_in:!!r("logged_in")}),S.___err=!0}catch(a){}}function u(t,n){"number"==typeof n&&E.random()>n||(t instanceof b?(t.url||(t.url="//www.tumblr.com/"),a(t.message,t.url,t.ln,t.col,t)):T.push(I(t)))}function c(t){for(var n,e,r=t.length;r>0;)e=E.floor(E.random()*r),r--,n=t[r],t[r]=t[e],t[e]=n;return t}function s(t){if(!y||!y.getEntriesByType)return t;var n=y.getEntriesByType("resource"),e={};x(n,function(t){var n=(t.name.match(/\/\/([^\/]+)/)||"")[1];if(n.indexOf(".tumblr.")!==-1){e[t.initiatorType]||(e[t.initiatorType]=[]);var r=n.split(".")[0];e[t.initiatorType].push({name:t.name.split(n)[1],duration:(t.duration||"").toString(),bucket:r,protocol:(t.nextHopProtocol||"").toString(),timing:{redirectStart:(t.redirectStart||"").toString(),redirectEnd:(t.redirectEnd||"").toString(),fetchStart:(t.fetchStart||"").toString(),domainLookupStart:(t.domainLookupStart||"").toString(),domainLookupEnd:(t.domainLookupEnd||"").toString(),connectStart:(t.connectStart||"").toString(),connectEnd:(t.connectEnd||"").toString(),secureConnectionStart:(t.secureConnectionStart||"").toString(),requestStart:(t.requestStart||"").toString(),responseStart:(t.responseStart||"").toString(),responseEnd:(t.responseEnd||"").toString(),transferSize:(t.transferSize||"").toString()}})}}),j.entries||(j.entries=[]);for(var r=[{type:"img",num:10},{type:"link",num:2},{type:"script",num:2},{type:"css",num:2}],o=0;o<r.length;++o){var i=r[o],a=e[i.type];if(a)for(i.num<a.length&&c(a);i.num&&a.length;)j.entries.push(a.pop()),--i.num}return R(j)&&((t||(t={})).perf=j,j.timing=y.timing,j.memory=y.memory,j.navigation=y.navigation),t}function g(){try{k||(N.length=0,u(new b("PAGE_DID_NOT_LOAD")));var n;if(!i()&&A("enable_js_errors_log")(function(){N.length&&((n||(n={})).errors=N)}),A("js_performance_logging")(function(){try{n=s(n)}catch(t){}}),A("enable_js_ephemeral_log")(function(){T.length&&((n||(n={})).ephemeral=T)}),!n)return;var e=JSON.stringify({form_key:(h.getElementById("tumblr_form_key")||h.body).getAttribute("content"),gpop:(h.getElementById("tumblr_gpop")||h.body).getAttribute("content"),log:n}),r=new O;r.open("POST","/svc/log/capture/exceptions?mode=xhr"),r.setRequestHeader("Content-type","application/json"),r.onreadystatechange=function(){4===r.readyState&&(N.length=T.length=0)},r.send(e)}catch(o){if(!t.jQuery)return;(n||(n={})).errors||(n.errors=N),t.jQuery.ajax({dataType:"json",contentType:"application/json",type:"POST",data:{form_key:t.jQuery("#tumblr_form_key").attr("content"),log:n},url:"/svc/log/capture/exceptions?mode=jquery",withFormKey:!0}),u(o)}}function l(){j.page_info={},j.page_info.path=h.location.pathname||"n/a"}function p(){var t=(new v).getTime(),n=t-y.timing.navigationStart;j.page_load_time=n}function f(){if(y&&y.timing)try{l(),p()}catch(t){}}function m(){k=!0,f()}var h=t.document,_=t.navigator,d=t.parseInt,y=t.performance,S=t.window,v=t.Date,b=t.Error,E=t.Math,O=t.XMLHttpRequest,T=[],N=[],j={},k=!1,w=/https?:\/\//,L=/https?:\/\/[^\/]*tumblr[^\/]*/,I=function(t){return t&&t.stringify&&function(n){try{return t.stringify(n)}catch(e){return u(e),'"FAILED_JSON_STRINGIFY"'}}||function(){return'"NO_JSON_STRINGIFY"'}}(t.JSON),A=function(t){return t&&t.Flags||function(){function t(t,n){return"function"==typeof t?t.call(this,n):t}u(new b("Missing Tumblr.Flags in exceptions.js"));var n={enable_js_errors_log:!0,enable_js_ephemeral_log:!0};return function(e){var r=!!n[e];return function o(n,e){var i=t.call(this,r?n:e,r);return void 0!==i?i:o}}}()}(t.Tumblr),R=function(t){return t&&t.keys||function(n){var e=[],r=t.prototype.hasOwnProperty;for(var o in n)r.call(n,o)&&e.push(o);return e}}(t.Object),x=function(t,n,e){if("function"==typeof n)for(var r=(t&&t.length)>>>0,o=0;o<r;o++)n.call(e,t[o],o,t)};u.debugDump=function(){var n=[];return x(h.getElementsByTagName("script"),function(t){n.push(t.src)}),{timestamp:+new v,path:(h.location||{}).href||"NO_HREF",lang:(_||{}).userLanguage||(_||{}).language||"NO_LANG",referrer:h.referrer||"NO_REFERRER",ua:(_||{}).userAgent||"NO_UA",timing:(y||{}).timing||"NO_TIMING",scripts:n,globals:R(t),cookie:h.cookie,ephemeral:T,errors:N,document:(h.documentElement||{}).innerHTML||"NO_DOCUMENT"}};!function(){e(S,"beforeunload",g),S.onerror=a}(),(n.Utils||(n.Utils={})).exceptions=u,e(S,"load",m)}(this,this.Tumblr||(this.Tumblr={}));