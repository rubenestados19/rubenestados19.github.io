!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).HdSdk={})}(this,(function(e){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,n)};var n,r=function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function o(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n}function i(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))}function a(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}function s(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||t)}var c=new Uint8Array(16);function u(){if(!n&&!(n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return n(c)}var d=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function p(e){return"string"==typeof e&&d.test(e)}for(var l=[],f=0;f<256;++f)l.push((f+256).toString(16).substr(1));function v(e,t,n){var r=(e=e||{}).random||(e.rng||u)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(var o=0;o<16;++o)t[n+o]=r[o];return t}return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(l[e[t+0]]+l[e[t+1]]+l[e[t+2]]+l[e[t+3]]+"-"+l[e[t+4]]+l[e[t+5]]+"-"+l[e[t+6]]+l[e[t+7]]+"-"+l[e[t+8]]+l[e[t+9]]+"-"+l[e[t+10]]+l[e[t+11]]+l[e[t+12]]+l[e[t+13]]+l[e[t+14]]+l[e[t+15]]).toLowerCase();if(!p(n))throw TypeError("Stringified UUID is invalid");return n}(r)}function h(e){return e&&"[object Function]"==={}.toString.call(e)}function g(e){return e instanceof Error?e:new Error(String(e))}var m="106",y=["PageView","HomePageView","ViewProductList","ViewSearchResults","PageLeave","PageDuration","HeartBeat","View","ViewSuccess","ViewContent","AddToCart","InitiateCheckout","AddCustomerInfo","AddShippingInfo","AddPaymentInfo","Purchase","SearchResults","CompleteRegistration","Search","Lead","Login","SelectContent","RemoveFromCart","ViewCart","ViewItem","ViewItemList"],_=["View","ViewSuccess"],w=["InitiateCheckout","AddCustomerInfo","AddShippingInfo","AddPaymentInfo","Purchase"],b={event_name:function(e){return"string"==typeof e&&/^[a-zA-Z_]+$/.test(e)},event_id:function(e){return"number"==typeof e},app_id:function(e){return!!e},event_ext_info:function(e){return void 0===e||function(e){return"object"==typeof e&&!Array.isArray(e)&&null!==e}(e)}};function S(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function k(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function T(e,t,n){return t&&k(e.prototype,t),n&&k(e,n),e}function O(e){return(O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function L(e,t){return!t||"object"!==O(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function I(e){return(I=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function x(e,t){return(x=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function E(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&x(e,t)}function R(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function P(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function D(e){return function(e){if(Array.isArray(e))return P(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return P(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?P(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function A(e,t,n,r,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function C(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function a(e){A(i,r,o,a,s,"next",e)}function s(e){A(i,r,o,a,s,"throw",e)}a(void 0)}))}}function N(e,t,n){return(N="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=I(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}var M="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function j(e,t){return e(t={exports:{}},t.exports),t.exports}var U=j((function(e){var t=function(e){var t,n=Object.prototype,r=n.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function u(e,t,n,r){var o=t&&t.prototype instanceof g?t:g,i=Object.create(o.prototype),a=new x(r||[]);return i._invoke=function(e,t,n){var r=p;return function(o,i){if(r===f)throw new Error("Generator is already running");if(r===v){if("throw"===o)throw i;return R()}for(n.method=o,n.arg=i;;){var a=n.delegate;if(a){var s=O(a,n);if(s){if(s===h)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===p)throw r=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=f;var c=d(e,t,n);if("normal"===c.type){if(r=n.done?v:l,c.arg===h)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r=v,n.method="throw",n.arg=c.arg)}}}(e,n,a),i}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var p="suspendedStart",l="suspendedYield",f="executing",v="completed",h={};function g(){}function m(){}function y(){}var _={};_[i]=function(){return this};var w=Object.getPrototypeOf,b=w&&w(w(E([])));b&&b!==n&&r.call(b,i)&&(_=b);var S=y.prototype=g.prototype=Object.create(_);function k(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function T(e,t){function n(o,i,a,s){var c=d(e[o],e,i);if("throw"!==c.type){var u=c.arg,p=u.value;return p&&"object"==typeof p&&r.call(p,"__await")?t.resolve(p.__await).then((function(e){n("next",e,a,s)}),(function(e){n("throw",e,a,s)})):t.resolve(p).then((function(e){u.value=e,a(u)}),(function(e){return n("throw",e,a,s)}))}s(c.arg)}var o;this._invoke=function(e,r){function i(){return new t((function(t,o){n(e,r,t,o)}))}return o=o?o.then(i,i):i()}}function O(e,n){var r=e.iterator[n.method];if(r===t){if(n.delegate=null,"throw"===n.method){if(e.iterator.return&&(n.method="return",n.arg=t,O(e,n),"throw"===n.method))return h;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return h}var o=d(r,e.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,h;var i=o.arg;return i?i.done?(n[e.resultName]=i.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,h):i:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,h)}function L(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function I(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function x(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(L,this),this.reset(!0)}function E(e){if(e){var n=e[i];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function n(){for(;++o<e.length;)if(r.call(e,o))return n.value=e[o],n.done=!1,n;return n.value=t,n.done=!0,n};return a.next=a}}return{next:R}}function R(){return{value:t,done:!0}}return m.prototype=S.constructor=y,y.constructor=m,m.displayName=c(y,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===m||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,c(e,s,"GeneratorFunction")),e.prototype=Object.create(S),e},e.awrap=function(e){return{__await:e}},k(T.prototype),T.prototype[a]=function(){return this},e.AsyncIterator=T,e.async=function(t,n,r,o,i){void 0===i&&(i=Promise);var a=new T(u(t,n,r,o),i);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},k(S),c(S,s,"Generator"),S[i]=function(){return this},S.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=E,x.prototype={constructor:x,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(I),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function o(r,o){return s.type="throw",s.arg=e,n.next=r,o&&(n.method="next",n.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=r.call(a,"catchLoc"),u=r.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,h):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),I(n),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;I(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:E(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),h}},e}(e.exports);try{regeneratorRuntime=t}catch(e){Function("r","regeneratorRuntime = r")(t)}}));function H(e){return JSON.parse(JSON.stringify(e))}var V="application/x-www-form-urlencoded",F=49152,B="The query length cannot exceed ".concat(48,"K");function q(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var G={useHttps:!0,useRetry:!0,retryTimes:1,maxRequest:5},z=function(){return T((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:G,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};S(this,e),this.configure(t),this.override(n)}),[{key:"configure",value:function(e){var t,n=Object.assign({},this.options,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?q(Object(n),!0).forEach((function(t){R(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):q(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e));0<n.retryTimes&&n.retryTimes<4||(n.retryTimes=1),-1!==(null===(t=window.location)||void 0===t||null===(t=t.protocol)||void 0===t?void 0:t.indexOf("https"))&&(n.useHttps=!0),this.options=n}},{key:"merge",value:function(e){this.data=Object.assign({},this.data,e)}},{key:"override",value:function(e){this.data=H(e)}},{key:"use",value:function(e,t){if("function"==typeof t)switch(e){case"url":this.urlInterceptor=t;break;case"request":this.requestInterceptor=t}}},{key:"processTrackingData",value:function(e){var t=Object.assign({},this.data,e),n=this.completeTrackingData(t);return this.pretreateTrackingData(n)}},{key:"encodeTrackingData",value:function(e){return function(e){if("object"!==O(e))return e;var t=function(e,n){var r=[];if("object"===O(e))return Object.keys(e).forEach((function(o){var i=e[o];"object"===O(i)?r=""!=n?r.concat(t(i,n+"["+o+"]")):r.concat(t(i,o)):void 0!==i&&(""!=n?r.push(n,"[",o,"]","=",encodeURIComponent(i),"&"):r.push(o,"=",encodeURIComponent(i),"&"))})),r};return t(e,"").slice(0,-1).join("")}(this.formatTrackingData(e))}},{key:"completeTrackingData",value:function(e){var t,n,r,o,i={act:"websdkentmaster",time:Math.floor((new Date).getTime()/1e3),domain:null===(t=window)||void 0===t||null===(t=t.location)||void 0===t?void 0:t.hostname,url:null===(n=window)||void 0===n||null===(n=n.location)||void 0===n?void 0:n.href,ua:null===(r=window)||void 0===r||null===(r=r.navigator)||void 0===r?void 0:r.userAgent,ref:null===(o=document)||void 0===o?void 0:o.referrer,data_id:v(),request_time:Date.now()};return Object.assign({},i,e)}},{key:"formatMoreInfoData",value:function(e){var t,n={language:null===(t=window)||void 0===t?void 0:t.navigator.language,is_mobile:this.getIsMobile()};return Object.assign({},n,e)}},{key:"getMobile",value:function(){var e,t=null===(e=window)||void 0===e?void 0:e.navigator.userAgent,n=!t.match(/(iPad).*OS\s([\d_]+)/)&&t.match(/(iPhone\sOS)\s([\d_]+)/),r=t.match(/(Android)\s+([\d.]+)/);return n||r}},{key:"getIsMobile",value:function(){return this.getMobile()?"101":"102"}},{key:"pretreateTrackingData",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.options,n=this.requestInterceptor;return"function"==typeof n?n(e,t):e}},{key:"formatTrackingData",value:function(e){var t=H(e);return t.moreinfo||(t.moreinfo={}),"object"===O(t.moreinfo)&&(t.moreinfo=this.formatMoreInfoData(t.moreinfo),t.moreinfo=JSON.stringify(t.moreinfo)),"localhost"===t.domain&&(t.domain=""),t}},{key:"destory",value:function(){this.data=void 0,this.options=void 0,this.urlInterceptor=void 0,this.requestInterceptor=void 0}}])}(),J=new Array(15);function Y(e,t){return 506832829*e>>>t}function K(e,t){return e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24)}function W(e,t,n){return e[t]===e[n]&&e[t+1]===e[n+1]&&e[t+2]===e[n+2]&&e[t+3]===e[n+3]}function $(e,t,n,r,o){return n<=60?(r[o]=n-1<<2,o+=1):n<256?(r[o]=240,r[o+1]=n-1,o+=2):(r[o]=244,r[o+1]=n-1&255,r[o+2]=n-1>>>8,o+=3),function(e,t,n,r,o){for(var i=0;i<o;i++)n[r+i]=e[t+i]}(e,t,r,o,n),o+n}function X(e,t,n,r){return r<12&&n<2048?(e[t]=1+(r-4<<2)+(n>>>8<<5),e[t+1]=255&n,t+2):(e[t]=2+(r-1<<2),e[t+1]=255&n,e[t+2]=n>>>8,t+3)}function Z(e,t,n,r){for(;r>=68;)t=X(e,t,n,64),r-=64;return r>64&&(t=X(e,t,n,60),r-=60),X(e,t,n,r)}function Q(e,t,n,r,o){for(var i=1;1<<i<=n&&i<=14;)i+=1;var a=32-(i-=1);void 0===J[i]&&(J[i]=new Uint16Array(1<<i));for(var s=J[i],c=0;c<s.length;c++)s[c]=0;var u,d,p,l,f,v,h,g,m,y,_=t+n,w=t,b=t,S=!0;if(n>=15)for(u=_-15,p=Y(K(e,t+=1),a);S;){v=32,l=t;do{if(d=p,h=v>>>5,v+=1,l=(t=l)+h,t>u){S=!1;break}p=Y(K(e,l),a),f=w+s[d],s[d]=t-w}while(!W(e,t,f));if(!S)break;o=$(e,b,t-b,r,o);do{for(g=t,m=4;t+m<_&&e[t+m]===e[f+m];)m+=1;if(t+=m,o=Z(r,o,g-f,m),b=t,t>=u){S=!1;break}s[Y(K(e,t-1),a)]=t-1-w,f=w+s[y=Y(K(e,t),a)],s[y]=t-w}while(W(e,t,f));if(!S)break;p=Y(K(e,t+=1),a)}return b<_&&(o=$(e,b,_-b,r,o)),o}var ee=function(){return T((function e(t){S(this,e),this.sources=t}),[{key:"maxCompressedLength",value:function(){var e=this.sources.length;return 32+e+Math.floor(e/6)}},{key:"compressToBuffer",value:function(e){var t,n=this.sources,r=n.length,o=0,i=0;for(i=function(e,t,n){do{t[n]=127&e,(e>>>=7)>0&&(t[n]+=128),n+=1}while(e>0);return n}(r,e,i);o<r;)i=Q(n,o,t=Math.min(r-o,65536),e,i),o+=t;return i}}])}();function te(e){return e instanceof Uint8Array}function ne(e){return e instanceof ArrayBuffer}function re(e){if(!te(e)&&!ne(e)&&(t=e,!Buffer.isBuffer(t)))throw new TypeError("Argument compressed must be type of ArrayBuffer, Buffer, or Uint8Array");var t,n,r=!1,o=!1;te(e)?(r=!0,n=e):ne(e)&&(o=!0,n=new Uint8Array(e));var i,a,s,c=new ee(n),u=c.maxCompressedLength();return r?(i=new Uint8Array(u),s=c.compressToBuffer(i)):o?(i=new ArrayBuffer(u),a=new Uint8Array(i),s=c.compressToBuffer(a)):(i=Buffer.alloc(u),s=c.compressToBuffer(i)),i.slice(0,s)}function oe(e){return re(function(e){for(var t=new Uint8Array(e.length),n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t.buffer}(e))}var ie=Math.pow(2,31)-1;function ae(e){return new Promise((function(t){var n=Number.isSafeInteger(e)&&e>0?e:0;setTimeout(t,n>ie?ie:n)}))}function se(e,t,n){return t=I(t),L(e,ce()?Reflect.construct(t,n||[],I(e).constructor):t.apply(e,n))}function ce(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(ce=function(){return!!e})()}function ue(e,t,n,r){var o=N(I(1&r?e.prototype:e),t,n);return 2&r&&"function"==typeof o?function(e){return o.apply(n,e)}:o}var de=Object.assign({},G,{wait:"immediately"}),pe=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:de,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return S(this,t),(e=se(this,t,[n,r])).trackingTasks=[],e.trackingReportors=[],e}return E(t,e),T(t,[{key:"report",value:(i=C(U.mark((function e(t){var n,r,o=arguments;return U.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=o.length>1&&void 0!==o[1]&&o[1],Array.isArray(t)){e.next=3;break}return e.abrupt("return",this.report([t],n));case 3:if(this.addTask.apply(this,D(t)),!n){e.next=7;break}return r=this.trackingTasks.pop(),e.abrupt("return",this.tryReport([r]));case 7:return e.abrupt("return",this.runReport());case 8:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"post",value:(o=C(U.mark((function e(){var t;return U.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((t=this.freeTrackingTask()).length>0)){e.next=5;break}return this.tryReport(t),e.abrupt("continue",0);case 5:return e.abrupt("break",8);case 8:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"use",value:function(e,n){ue(t,"use",this,3)([e,n])}},{key:"addTask",value:function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];n.forEach((function(t){var n=e.processTrackingData(t),r=e.encodeTrackingData(n);if(e.validTrackingData(r,n)){var o={encoded:r,source:n};e.trackingTasks.push(o)}}))}},{key:"runReport",value:(r=C(U.mark((function e(){var n,r,o,i,a;return U.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.options,r=n.maxRequest,o=n.wait,!(this.trackingReportors.length>=r)){e.next=4;break}return e.next=4,Promise.all(this.trackingReportors);case 4:if(!t.supported){e.next=13;break}if("nextTick"!==o){e.next=10;break}return e.next=8,Promise.resolve();case 8:e.next=13;break;case 10:if("number"!=typeof o){e.next=13;break}return e.next=13,ae(o);case 13:if(!((i=this.freeTrackingTask()).length>0)){e.next=18;break}return a=this.tryReport(i),e.next=18,this.pushReport(a);case 18:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"freeTrackingTask",value:function(){var e;if(null===(e=this.trackingTasks)||void 0===e||!e.length)return[];for(var t=1,n=0;n<this.trackingTasks.length;n++){if((t+=this.trackingTasks[n].encoded.length+3)>F)return this.trackingTasks.splice(0,n)}return this.trackingTasks.splice(0)}},{key:"tryReport",value:(n=C(U.mark((function e(t){var n,r,o,i,a,s,c,u,d=arguments;return U.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=d.length>1&&void 0!==d[1]?d[1]:0,e.prev=1,r=this.options,o=r.useHttps,i=r.domain,a="http".concat(!1!==o?"s":"","://").concat(i),e.next=6,this.delegateRequest(a,t);case 6:e.next=16;break;case 8:if(e.prev=8,e.t0=e.catch(1),s=this.options,c=s.useRetry,u=s.retryTimes,!(!0===c&&u>n)){e.next=15;break}return e.next=14,this.tryReport(t,n+1);case 14:return e.abrupt("return",e.sent);case 15:return e.abrupt("return",Promise.reject(e.t0));case 16:case"end":return e.stop()}}),e,this,[[1,8]])}))),function(e){return n.apply(this,arguments)})},{key:"pushReport",value:function(e){var t=this,n=function(){var n=t.trackingReportors.indexOf(e);t.trackingReportors.splice(n,1)},r=e.then(n).catch((function(e){return n(),Promise.reject(e)}));return this.trackingReportors.push(r),r}},{key:"delegateRequest",value:function(e,t){if(!Array.isArray(t)){var n=this.interceptUrl("".concat(e,"/").concat("n.gif"),t);return this.options.skipReport?Promise.resolve():this.send(n,t.encoded)}return 1===t.length?this.delegateRequest(e,t[0]):this.mergeRequest(e,t)}},{key:"mergeRequest",value:function(e,t){var n=this,r=[];if("function"==typeof this.options.mergeTransformer){var o=t.map((function(e){return e.source}));r=this.options.mergeTransformer(o).map((function(e){return n.encodeTrackingData(e)}))}else r=t.map((function(e){return e.encoded}));var i=this.compressTrackingDatas(r),a=this.interceptUrl("".concat(e,"/").concat("o.gif","?cmp=1&enc=b64"),t);return this.options.skipReport?Promise.resolve():this.send(a,i)}},{key:"interceptUrl",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.options;return"function"==typeof this.urlInterceptor?this.urlInterceptor(e,t,n):e}},{key:"compressTrackingDatas",value:function(e){var t=oe(JSON.stringify(e)),n=String.fromCharCode.apply(null,new Uint8Array(t));return btoa(n)}},{key:"validTrackingData",value:function(e,t){var n,r,o;if("function"==typeof this.options.validateTrackingData&&!this.options.validateTrackingData(e,t))return!1;return!(e.length>F)||(n=B,"function"==typeof(null===(r=console)||void 0===r?void 0:r.error)?console.error(n):"function"==typeof(null===(o=console)||void 0===o?void 0:o.log)&&console.log(n),!1)}},{key:"destory",value:function(){ue(t,"destory",this,3)([]),this.trackingTasks.splice(0),this.trackingReportors.splice(0),this.trackingTasks=void 0,this.trackingReportors=void 0}}]);var n,r,o,i}(z);R(pe,"supported","function"==typeof btoa&&"undefined"!=typeof Uint16Array);var le=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"http request fail.",n=new Error(t),r=e.xhr,o={type:"ajax",response:null,event:e.event,data:e.data,xhr:r,status:r.status,responseText:r.responseText};try{o.response=JSON.parse(r.responseText)}catch(e){}return Object.assign(n,{detail:o})};function fe(e,t,n){return t=I(t),L(e,ve()?Reflect.construct(t,n||[],I(e).constructor):t.apply(e,n))}function ve(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(ve=function(){return!!e})()}var he=function(e){function t(){return S(this,t),fe(this,t,arguments)}return E(t,e),T(t,[{key:"send",value:function(e,t){return function(e,t){return new Promise((function(n,r){var o=new XMLHttpRequest;o.open("POST",e),o.onerror=function(e){var n=le({xhr:o,event:e,data:t});r(n)},o.onreadystatechange=function(e){if(o.readyState===XMLHttpRequest.DONE&&200===o.status)n();else{var i=le({xhr:o,event:e,data:t});(o.status>=500||o.status>=402&&o.status<=420||400==o.status||401==o.status)&&r(i)}},o.setRequestHeader("Content-Type",V),o.withCredentials=!1,o.send(t)}))}(e,t)}}])}(pe);R(he,"supported","undefined"!=typeof XMLHttpRequest);var ge,me=function(){var e=C(U.mark((function e(t,n){var r;return U.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=new Blob([n],{type:V}),navigator.sendBeacon(t,r)){e.next=4;break}throw new Error("Send beacon fail.");case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();function ye(e,t,n){return t=I(t),L(e,_e()?Reflect.construct(t,n||[],I(e).constructor):t.apply(e,n))}function _e(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(_e=function(){return!!e})()}var we=function(e){function t(){return S(this,t),ye(this,t,arguments)}return E(t,e),T(t,[{key:"send",value:function(e,t){return me(e,t)}}])}(pe);R(we,"supported","function"==typeof(null===(ge=navigator)||void 0===ge?void 0:ge.sendBeacon));var be=function(e){return e&&e.default||e}(Object.freeze({__proto__:null,default:function(e,t){var n=new we(e,t),r=new he(e,t),o={httpInstance:r,beaconInstance:n};return we.supported?Object.assign(n,o):he.supported?Object.assign(r,o):void 0}}));function Se(e,t){for(var n={},r=0,o=t.length;r<o;r++){var i=t[r];i&&Object.prototype.hasOwnProperty.call(e,i)&&(n["".concat(i)]=e[i],delete e[i])}return n}function ke(e){return"".concat(e).startsWith("_")?e:"_".concat(e)}function Te(e,t){var n;null===(n=window.__SL_Track__)||void 0===n||n.error("ECDATA",{owner:"HdSdk_ShopTracker",msg:e,error:null==t?void 0:t.message})}function Oe(){var e,t,n=null===(e=window.Shopline)||void 0===e?void 0:e.storeId,r=(null===(t=window.SL_Report)||void 0===t?void 0:t.storageTypeMap)||{};if(!n)return"localStorage";var o=Object.entries(r).find((function(e){return e[0],e[1].includes(n)}));return(null==o?void 0:o[0])||"localStorage"}var Le,Ie,xe,Ee,Re,Pe,De,Ae,Ce,Ne=j((function(e,t){var n;n=function(){function e(){for(var e=0,t={};e<arguments.length;e++){var n=arguments[e];for(var r in n)t[r]=n[r]}return t}function t(e){return e.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}return function n(r){function o(){}function i(t,n,i){if("undefined"!=typeof document){"number"==typeof(i=e({path:"/"},o.defaults,i)).expires&&(i.expires=new Date(1*new Date+864e5*i.expires)),i.expires=i.expires?i.expires.toUTCString():"";try{var a=JSON.stringify(n);/^[\{\[]/.test(a)&&(n=a)}catch(e){}n=r.write?r.write(n,t):encodeURIComponent(String(n)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=encodeURIComponent(String(t)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var s="";for(var c in i)i[c]&&(s+="; "+c,!0!==i[c]&&(s+="="+i[c].split(";")[0]));return document.cookie=t+"="+n+s}}function a(e,n){if("undefined"!=typeof document){for(var o={},i=document.cookie?document.cookie.split("; "):[],a=0;a<i.length;a++){var s=i[a].split("="),c=s.slice(1).join("=");n||'"'!==c.charAt(0)||(c=c.slice(1,-1));try{var u=t(s[0]);if(c=(r.read||r)(c,u)||t(c),n)try{c=JSON.parse(c)}catch(e){}if(o[u]=c,e===u)break}catch(e){}}return e?o[e]:o}}return o.set=i,o.get=function(e){return a(e,!1)},o.getJSON=function(e){return a(e,!0)},o.remove=function(t,n){i(t,"",e(n,{expires:-1}))},o.defaults={},o.withConverter=n,o}((function(){}))},e.exports=n()})),Me=function(e,t){ct&&Te("cookieStorage_".concat(e),t)},je=function(){function e(e){void 0===e&&(e={}),this.defaultOptions={path:"/",expires:365},this.defaultOptions=r(r({},this.defaultOptions),e)}return e.prototype.set=function(e,t,n,o,i){var a;void 0===n&&(n=30),void 0===o&&(o=0),void 0===i&&(i={});var s=r(r({},this.defaultOptions),i),c={value:t,timeOffset:o,maxAge:null};if(n){var u=Date.now()-(o||0)+n*ot;c.maxAge=u}try{Ne.set(e,JSON.stringify(c),{path:s.path,expires:s.expires})}catch(e){Me("set",e)}null===(a=i.callback)||void 0===a||a.call(i,c)},e.prototype.getRaw=function(e){var t={value:null,maxAge:null,timeOffset:0};try{var n=Ne.get(e),r=n?JSON.parse(n):null;r&&(t=r)}catch(e){Me("getRaw",e)}return t},e.prototype.append=function(e,t,n){var r=void 0;try{var o=this.getRaw(e);o.value&&(r=Object.assign(o.value,t),this.set(e,r))}catch(e){Me("append",e)}return r&&(null==n||n(r)),r},e.prototype.remove=function(e){Ne.remove(e,{path:this.defaultOptions.path})},e}(),Ue="__hdsdk::test",He=function(e,t){ct&&Te(e,t)},Ve=function(){var e=null;if(ct){var t=Oe();if(t&&"cookie"!==t)e=t;else try{localStorage.setItem(Ue,"1");var n=localStorage.getItem(Ue);localStorage.removeItem(Ue),"1"===n?e="localStorage":(e="sessionStorage",He("sessionStorage_1"))}catch(t){e="sessionStorage",He("sessionStorage_2",t)}}return"sessionStorage"===e?sessionStorage:localStorage}(),Fe=function(e){var t=null;try{var n=Ve.getItem(e);n&&(t=JSON.parse(n))}catch(e){He("getStorageData_parseError",e)}return t},Be=function(e,t){var n=JSON.stringify(t);try{localStorage.setItem(e,n)}catch(e){He("setStorageData_error",e)}ct&&sessionStorage.setItem(e,n)},qe=new(function(){function e(){}return e.prototype.get=function(e){var t;try{var n=Fe(e);n&&n.value&&(n.maxAge?n.maxAge>Date.now()-(n.timeOffset||0)?t=n.value:this.remove(e):t=n.value)}catch(e){}return t},e.prototype.set=function(e,t,n,r,o){var i;void 0===r&&(r=0);var a={value:t,maxAge:n?Date.now()-r+60*n*1e3:null,timeOffset:r};try{Be(e,a)}catch(e){He("set",e)}null===(i=null==o?void 0:o.callback)||void 0===i||i.call(o,a)},e.prototype.remove=function(e){!function(e){localStorage.removeItem(e),ct&&sessionStorage.removeItem(e)}(e)},e.prototype.getRaw=function(e){var t={value:null,maxAge:null,timeOffset:0};try{var n=Fe(e);n&&n.value&&(t=n)}catch(e){}return t},e.prototype.isExpired=function(e){try{var t=Fe(e);return!t||!t.value||!(!t.maxAge||t.maxAge&&t.maxAge>(Date.now()-t.timeOffset||0))}catch(e){}return!0},e.prototype.append=function(e,t,n){var r=Fe(e);try{if(r&&r.value)return Object.assign(r.value,t),Be(e,r),null==n||n(r),r.value}catch(e){He("append",e)}r&&(null==n||n(r))},e}()),Ge="tracker_cid",ze="tracker_sid",Je="osudb_uid",Ye="merchant_id",Ke="store_id",We={wait:20},$e="admintoC",Xe="webslcodetrack",Ze="websdkprotocol",Qe="webslplugincodetrack",et="-999",tt=["preview","product"],nt="tracker_landing",rt=["merchant_id","user_id","version","store_timezone","user_timezone","store_region"],ot=6e4,it=60*ot*24,at=(Le=navigator.userAgent,Ie=/iPad|iPhone|iPod/.test(Le),xe=/FBIOS/.test(Le),Ie&&xe),st=function(){var e;return(null===(e=window.SL_Report)||void 0===e?void 0:e.isHitSunfereGray)||!1}(),ct=at&&st,ut="941223b422c64b1d8c6fb927750fbc81",dt="1e21d61b1992449590ac489a461595b4",pt=Oe(),lt=ct&&"cookie"===pt,ft=new je,vt=lt?ft:qe,ht="dc_new_stat_tracker_nsid",gt=Object.freeze({__proto__:null,PROD_ID:"shopline",HTTP_COOKIE_KEY:Ge,SESSION_ID_KEY:ze,UID_KEY:Je,MERCHANT_ID_KEY:Ye,STORE_ID_KEY:Ke,COOKIE_SESSION_KEY:"n_sess",TRACKER_OPTIONS:We,APP_ID:"101",PROJECT_ID:$e,ACT:Xe,LEGACY_ACT:Ze,PLUGIN_ACT:Qe,DEFAULT_CODE:et,REPORT_ENV:tt,LANDING_SIGN:nt,OUTSIDE_PROPERTIES:rt,MILLISECONDS_PER_MINUTE:ot,MILLISECONDS_PER_DAY:it,NEED_GREY:ct,HTTP_COOKIE_KEY_BAK:ut,SESSION_ID_KEY_BAK:dt,GREY_STORAGE_TYPE:pt,USE_COOKIE_STORAGE:lt,STORE_UTILS:vt,NEW_STAT_ID_KEY:ht}),mt=-1,yt=function(e){addEventListener("pageshow",(function(t){t.persisted&&(mt=t.timeStamp,e(t))}),!0)},_t=function(){return window.performance&&performance.getEntriesByType&&performance.getEntriesByType("navigation")[0]},wt=function(){var e=_t();return e&&e.activationStart||0},bt=function(e,t){var n=_t(),r="navigate";return mt>=0?r="back-forward-cache":n&&(r=document.prerendering||wt()>0?"prerender":document.wasDiscarded?"restore":n.type.replace(/_/g,"-")),{name:e,value:void 0===t?-1:t,rating:"good",delta:0,entries:[],id:"v3-".concat(Date.now(),"-").concat(Math.floor(8999999999999*Math.random())+1e12),navigationType:r}},St=function(e,t,n){try{if(PerformanceObserver.supportedEntryTypes.includes(e)){var r=new PerformanceObserver((function(e){Promise.resolve().then((function(){t(e.getEntries())}))}));return r.observe(Object.assign({type:e,buffered:!0},n||{})),r}}catch(e){}},kt=function(e,t){var n=function n(r){"pagehide"!==r.type&&"hidden"!==document.visibilityState||(e(r),t&&(removeEventListener("visibilitychange",n,!0),removeEventListener("pagehide",n,!0)))};addEventListener("visibilitychange",n,!0),addEventListener("pagehide",n,!0)},Tt=function(e,t,n,r){var o,i;return function(a){t.value>=0&&(a||r)&&((i=t.value-(o||0))||void 0===o)&&(o=t.value,t.delta=i,t.rating=function(e,t){return e>t[1]?"poor":e>t[0]?"needs-improvement":"good"}(t.value,n),e(t))}},Ot=function(e){requestAnimationFrame((function(){return requestAnimationFrame((function(){return e()}))}))},Lt=function(e){document.prerendering?addEventListener("prerenderingchange",(function(){return e()}),!0):e()},It=-1,xt=function(){return"hidden"!==document.visibilityState||document.prerendering?1/0:0},Et=function(e){"hidden"===document.visibilityState&&It>-1&&(It="visibilitychange"===e.type?e.timeStamp:0,Pt())},Rt=function(){addEventListener("visibilitychange",Et,!0),addEventListener("prerenderingchange",Et,!0)},Pt=function(){removeEventListener("visibilitychange",Et,!0),removeEventListener("prerenderingchange",Et,!0)},Dt=function(){return It<0&&(It=xt(),Rt(),yt((function(){setTimeout((function(){It=xt(),Rt()}),0)}))),{get firstHiddenTime(){return It}}},At=function(e,t){t=t||{},Lt((function(){var n,r=[1800,3e3],o=Dt(),i=bt("FCP"),a=St("paint",(function(e){e.forEach((function(e){"first-contentful-paint"===e.name&&(a.disconnect(),e.startTime<o.firstHiddenTime&&(i.value=Math.max(e.startTime-wt(),0),i.entries.push(e),n(!0)))}))}));a&&(n=Tt(e,i,r,t.reportAllChanges),yt((function(o){i=bt("FCP"),n=Tt(e,i,r,t.reportAllChanges),Ot((function(){i.value=performance.now()-o.timeStamp,n(!0)}))})))}))},Ct=function(e,t){t=t||{},Lt((function(){var n,r=[.1,.25],o=bt("CLS"),i=-1,a=0,s=[],c=function(t){i>-1&&e(t)},u=function(e){e.forEach((function(e){if(!e.hadRecentInput){var t=s[0],r=s[s.length-1];a&&e.startTime-r.startTime<1e3&&e.startTime-t.startTime<5e3?(a+=e.value,s.push(e)):(a=e.value,s=[e]),a>o.value&&(o.value=a,o.entries=s,n())}}))},d=St("layout-shift",u);d&&(n=Tt(c,o,r,t.reportAllChanges),At((function(e){i=e.value,o.value<0&&(o.value=0,n())})),kt((function(){u(d.takeRecords()),n(!0)})),yt((function(){a=0,i=-1,o=bt("CLS",0),n=Tt(c,o,r,t.reportAllChanges),Ot((function(){return n()}))})))}))},Nt={passive:!0,capture:!0},Mt=new Date,jt=function(e,t){Ee||(Ee=t,Re=e,Pe=new Date,Vt(removeEventListener),Ut())},Ut=function(){if(Re>=0&&Re<Pe-Mt){var e={entryType:"first-input",name:Ee.type,target:Ee.target,cancelable:Ee.cancelable,startTime:Ee.timeStamp,processingStart:Ee.timeStamp+Re};De.forEach((function(t){t(e)})),De=[]}},Ht=function(e){if(e.cancelable){var t=(e.timeStamp>1e12?new Date:performance.now())-e.timeStamp;"pointerdown"==e.type?function(e,t){var n=function(){jt(e,t),o()},r=function(){o()},o=function(){removeEventListener("pointerup",n,Nt),removeEventListener("pointercancel",r,Nt)};addEventListener("pointerup",n,Nt),addEventListener("pointercancel",r,Nt)}(t,e):jt(t,e)}},Vt=function(e){["mousedown","keydown","touchstart","pointerdown"].forEach((function(t){return e(t,Ht,Nt)}))},Ft=function(e,t){t=t||{},Lt((function(){var n,r=[100,300],o=Dt(),i=bt("FID"),a=function(e){e.startTime<o.firstHiddenTime&&(i.value=e.processingStart-e.startTime,i.entries.push(e),n(!0))},s=function(e){e.forEach(a)},c=St("first-input",s);n=Tt(e,i,r,t.reportAllChanges),c&&kt((function(){s(c.takeRecords()),c.disconnect()}),!0),c&&yt((function(){var o;i=bt("FID"),n=Tt(e,i,r,t.reportAllChanges),De=[],Re=-1,Ee=null,Vt(addEventListener),o=a,De.push(o),Ut()}))}))},Bt=0,qt=1/0,Gt=0,zt=function(e){e.forEach((function(e){e.interactionId&&(qt=Math.min(qt,e.interactionId),Gt=Math.max(Gt,e.interactionId),Bt=Gt?(Gt-qt)/7+1:0)}))},Jt=function(){return Ae?Bt:performance.interactionCount||0},Yt=function(){"interactionCount"in performance||Ae||(Ae=St("event",zt,{type:"event",buffered:!0,durationThreshold:0}))},Kt=0,Wt=function(){return Jt()-Kt},$t=[],Xt={},Zt=function(e){var t=$t[$t.length-1],n=Xt[e.interactionId];if(n||$t.length<10||e.duration>t.latency){if(n)n.entries.push(e),n.latency=Math.max(n.latency,e.duration);else{var r={id:e.interactionId,latency:e.duration,entries:[e]};Xt[r.id]=r,$t.push(r)}$t.sort((function(e,t){return t.latency-e.latency})),$t.splice(10).forEach((function(e){delete Xt[e.id]}))}},Qt=function(e,t){t=t||{},Lt((function(){var n=[200,500];Yt();var r,o=bt("INP"),i=function(e){e.forEach((function(e){e.interactionId&&Zt(e),"first-input"===e.entryType&&!$t.some((function(t){return t.entries.some((function(t){return e.duration===t.duration&&e.startTime===t.startTime}))}))&&Zt(e)}));var t,n=(t=Math.min($t.length-1,Math.floor(Wt()/50)),$t[t]);n&&n.latency!==o.value&&(o.value=n.latency,o.entries=n.entries,r())},a=St("event",i,{durationThreshold:t.durationThreshold||40});r=Tt(e,o,n,t.reportAllChanges),a&&(a.observe({type:"first-input",buffered:!0}),kt((function(){i(a.takeRecords()),o.value<0&&Wt()>0&&(o.value=0,o.entries=[]),r(!0)})),yt((function(){$t=[],Kt=Jt(),o=bt("INP"),r=Tt(e,o,n,t.reportAllChanges)})))}))},en={},tn=function(e,t){t=t||{},Lt((function(){var n,r=[2500,4e3],o=Dt(),i=bt("LCP"),a=function(e){var t=e[e.length-1];if(t){var r=Math.max(t.startTime-wt(),0);r<o.firstHiddenTime&&(i.value=r,i.entries=[t],n())}},s=St("largest-contentful-paint",a);if(s){n=Tt(e,i,r,t.reportAllChanges);var c=function(){en[i.id]||(a(s.takeRecords()),s.disconnect(),en[i.id]=!0,n(!0))};["keydown","click"].forEach((function(e){addEventListener(e,c,{once:!0,capture:!0})})),kt(c,!0),yt((function(o){i=bt("LCP"),n=Tt(e,i,r,t.reportAllChanges),Ot((function(){i.value=performance.now()-o.timeStamp,en[i.id]=!0,n(!0)}))}))}}))},nn=function e(t){document.prerendering?Lt((function(){return e(t)})):"complete"!==document.readyState?addEventListener("load",(function(){return e(t)}),!0):setTimeout(t,0)},rn=function(e,t){t=t||{};var n=[800,1800],r=bt("TTFB"),o=Tt(e,r,n,t.reportAllChanges);nn((function(){var i=_t();if(i){var a=i.responseStart;if(a<=0||a>performance.now())return;r.value=Math.max(a-wt(),0),r.entries=[i],o(!0),yt((function(){r=bt("TTFB",0),(o=Tt(e,r,n,t.reportAllChanges))(!0)}))}}))},on=new(function(){function e(){this.cacheSessionItem=null,this.webVitals={CLS:"",FCP:"",FID:"",INP:"",LCP:"",TTFB:""},this.getWebVitals(),this.setCacheSessionItem=this.setCacheSessionItem.bind(this),this.getSessionId=this.getSessionId.bind(this)}return e.prototype.setCacheSessionItem=function(e){this.cacheSessionItem=e},e.prototype.getHttpCookie=function(e){void 0===e&&(e=0);var t=qe.get(Ge);return t||(t=v(),qe.set(Ge,t,e)),ct&&qe.set(ut,t,e),t},e.prototype.getSessionId=function(e,t,n){void 0===e&&(e=30),void 0===t&&(t=0);var r=vt.getRaw(ze),o=+new Date;n&&(o-=n);var i=r.value;i||(this.cacheSessionItem?(i=(r=this.cacheSessionItem).value,Te("getSessionId::use cacheSessionItem: ".concat(JSON.stringify(r)))):i={});var a=i.sid||"",s=r.maxAge&&r.maxAge<o,c=+i.ite;if(!i.sid||s){i={sid:v(),createAt:o,rn:1,last_session_id:a,session_create_type:101};var u=document.referrer;if(u){var d=window.location.host;new URL(u).host!==d&&(i.ref=u)}s&&(i.session_create_type=c?103:102)}var p=new Date(o).setUTCHours(0,0,0,0);p<o&&(p+=it);var l=(p-o)/ot,f=o+new Date(o).getTimezoneOffset()*ot+1e3*t,h=(new Date(f+it).setHours(0,0,0,0)-f)/ot,g=Math.min(e,l,h);return i.ite=l<e||h<e?1:0,o+e*ot<i.createAt&&(i.createAt=o),vt.set(ze,i,g,n,{callback:this.setCacheSessionItem}),ct&&vt.set(dt,i,g,n),lt&&qe.set(ze,i,g,n,{callback:this.setCacheSessionItem}),i},e.prototype.getSession=function(){return vt.getRaw(ze)},e.prototype.getRawSessionId=function(){var e,t;return(null===(t=null===(e=this.getSession())||void 0===e?void 0:e.value)||void 0===t?void 0:t.sid)||""},e.prototype.upsetSessionRn=function(e){var t=e.rn||1,n=t+1;return vt.append(ze,{rn:n},this.setCacheSessionItem),vt.append(dt,{rn:n}),lt&&qe.append(ze,{rn:n},this.setCacheSessionItem),t},e.prototype.getHttpSearch=function(){return window.location.search},e.prototype.getUrlPath=function(){return window.location.pathname},e.prototype.getMobile=function(){var e=navigator.userAgent,t=!e.match(/(iPad).*OS\s([\d_]+)/)&&e.match(/(iPhone\sOS)\s([\d_]+)/),n=e.match(/(Android)\s+([\d.]+)/);return t||n},e.prototype.getIsMobile=function(){return this.getMobile()?"101":"102"},e.prototype.getWebsite=function(){return this.getMobile()?"102":"101"},e.prototype.getLanguage=function(){return navigator.language},e.prototype.getUserId=function(){return Ne.get(Je)},e.prototype.getMerchantId=function(){var e;return Ne.get(Ye)||(null===(e=window.Shopline)||void 0===e?void 0:e.merchantId)},e.prototype.getTitle=function(){var e;return null===(e=document.title)||void 0===e?void 0:e.substr(0,255)},e.prototype.getStoreId=function(){var e;return Ne.get(Ke)||(null===(e=window.Shopline)||void 0===e?void 0:e.storeId)},e.prototype.getScreenWidth=function(){return window.screen.width},e.prototype.getScreenHeight=function(){return window.screen.height},e.prototype.getWebVitals=function(){var e=this;[tn,Ft,Ct,Qt,At,rn].forEach((function(t){return t((function(t){e.webVitals[t.name]=t.value}))}))},e.prototype.getPerformance=function(){var e=window.performance||window.webkitPerformance,t={},n=e&&e.timing;if(e&&n){var r=0;if(window.chrome&&"function"==typeof window.chrome.loadTimes){var o=window.chrome.loadTimes();o&&(r=1e3*o.firstPaintTime,r-=n.navigationStart)}t.dns=Math.ceil(n.domainLookupEnd-n.domainLookupStart),t.tcp=Math.ceil(n.connectEnd-n.connectStart),t.request=Math.ceil(n.responseEnd-n.requestStart),t.connect=Math.ceil(n.responseStart-n.domainLookupStart),t.processing=Math.ceil((n.domComplete||n.domLoading)-n.domLoading),t.ready=Math.ceil(n.domContentLoadedEventEnd-n.navigationStart),t.load=Math.ceil(n.loadEventEnd-n.navigationStart),t.white=Math.ceil(n.responseStart-n.navigationStart),t.first_paint=r,t.first_paint||(t.first_paint=n.domLoading>=n.navigationStart?n.domLoading-n.navigationStart:0),t.first_paint=Math.ceil(t.first_paint),t.active=Math.ceil(n.domInteractive-n.navigationStart)}return t},e}()),an="1.7.14",sn=new(function(){function e(){this.statData=null}return e.prototype.getStatData=function(e){var t,n=(qe.getRaw(ht)||{}).value;n||this.statData&&(n=this.statData);var r=+new Date;if(!n||n.createUTCTime+it<r){var o=new Date(r).setUTCHours(0,0,0,0);n={statId:v(),lastStatId:null==n?void 0:n.statId,statRn:0,eventRnMap:{},createUTCTime:o}}if(e){var i=null!==(t=n.eventRnMap[e])&&void 0!==t?t:0;n.eventRnMap[e]=i+1}return n.statRn+=1,qe.set(ht,n),this.statData=n,n},e.prototype.addNewStatInfoToPayload=function(e){try{var t="eventName"in e&&"string"==typeof e.eventName?e.eventName:"",n=this.getStatData(t);return r(r({},e),{stat_id:n.statId,stat_rn:n.statRn,event_rn:t?n.eventRnMap[t]:void 0})}catch(t){return e}},e}()),cn=function(e,t){Te("".concat(e,"_deprecated"),t)},un=function(){function e(){var e,t;this.debugMode=!0,this.options=r(r({},We),{timezoneOffset:0,env:"",disableIframeId:!1,mergeTransformer:function(e){return e.reduce((function(e,t){if(5800===Number(t.event_id)){var n=e.find((function(e){return 5900===Number(e.event_id)}));n?n.moreinfo.list.push(t.moreinfo):e.push(r(r({},t),{event_id:5900,moreinfo:{list:[t.moreinfo]}}))}else e.push(t);return e}),[])},addStatInfoToMoreinfo:function(e){try{if(5800===Number(null==e?void 0:e.event_id)){var t=e.moreinfo;return"object"==typeof t&&null!==t&&"eventTracker"in t&&"Subscribed"===t.eventTracker?r(r({},e),{moreinfo:sn.addNewStatInfoToPayload(t)}):e}return e}catch(t){return e}}}),this.interceptor={},this.hdsdkFilterEvents=null===(t=null===(e=window.__ENV__)||void 0===e?void 0:e.ANALYTICS_UNIFY_CONFIG)||void 0===t?void 0:t.hdsdkFilterEvents}return e.prototype.validateParams=function(e){var t=this.hdsdkFilterEvents;if(!t||!t.enable||!t.events)return!0;var n=t.events[e.act||""];if(!(null==n?void 0:n.length))return!0;for(var r=function(t){var r=n[t],o=Object.keys(r);if(o.length&&o.every((function(t){var n=r[t],o=e[t];return"number"==typeof n?Number(n)===Number(o):n===o})))return{value:!1}},o=0;o<n.length;o++){var i=r(o);if("object"==typeof i)return i.value}return!0},e.prototype.setOptions=function(e){this.options=r(r({},this.options),e),-1!==tt.indexOf(this.options.env)&&this.setDebugMode(!1)},e.prototype.getOptions=function(){return this.options},e.prototype.setDebugMode=function(e){this.debugMode=e},e.prototype.initInstance=function(e){void 0===e&&(e={});var t=be;return t&&t.default&&(t=t.default),t(r(r(r({},this.options),e),{domain:"".concat(window.location.host,"/eclytics")}))},e.prototype.use=function(e,t){switch(e){case"url":case"request":this.interceptor[e]=t;break;default:this.instance?this._instanceUse(e,t):this.interceptor[e]=t}},e.prototype._instanceUse=function(e,t,n){void 0===n&&(n=this.instance),n&&(n.use(e,t),["httpInstance","beaconInstance"].forEach((function(r){var o;null===(o=n[r])||void 0===o||o.use(e,t)})))},e.prototype._interceptorUse=function(e){var t=this;void 0===e&&(e=this.instance),Object.keys(this.interceptor).filter((function(e){return!/(url|request)/.test(e)})).forEach((function(n){"function"==typeof t.interceptor[n]&&t._instanceUse(n,t.interceptor[n],e)}))},e.prototype._useRequestCallback=function(e){var t,n=this.options,o=n.timeOffset,i=n.formatParamsBeforeSend;if(o){if(e.__fromPlugin__){var a=e,s=a.moreinfo,c=a.event_info,u=a.request_time,d=c.event_created_at_ms;return e.event_info.event_created_at_ms=d-o,e.event_info.event_sent_at_ms=u-o,e.moreinfo=JSON.stringify(s),e.event_info=JSON.stringify(c),delete e.__fromPlugin__,delete e.request_time,delete e.time,delete e.domain,e}var p=e.event_created_at_ms,l=e.request_time,f=null===(t=e.moreinfo)||void 0===t?void 0:t.event_created_at_ms;f&&(e.moreinfo.event_created_at_ms=String(f-o)),e.event_created_at_ms=p?p-o:void 0,e.request_time=l-o,e.time=Math.ceil(e.request_time/1e3)}if(e.act===Ze)return e;var v=r(r({},e),{event_sent_at_ms:e.request_time});return delete v.request_time,v.$data_id&&(v.data_id=v.$data_id,delete v.$data_id),"function"==typeof i?i(v):v},e.prototype.getInstance=function(){var e=this;if(!this.instance){this.instance=this.initInstance();var t=v();this._instanceUse("url",(function(n,r,o){"function"==typeof e.interceptor.url&&(n=e.interceptor.url(n,r,o));var i=on.getSession().value;if(i&&i.sid){var a=i.sid,s=i.createAt,c=[].concat(r),u=function(e){var t=0;return(e=[].concat(e))&&e.length&&(t=e.some((function(e){var t,n,r,o;return"101"===String(null===(n=null===(t=e.source)||void 0===t?void 0:t.moreinfo)||void 0===n?void 0:n.event_name)&&"60006253"===String(null===(r=e.source)||void 0===r?void 0:r.eventid)||"PageView"===(null===(o=e.source)||void 0===o?void 0:o.event_name)}))),Number(t)}(c);return"".concat(n).concat(-1===n.indexOf("?")?"?":"&","_sid=").concat(a,"&_sct=").concat(s,"&_tid=").concat(t,"&_pdppv=").concat(u,"&_bcount=").concat(c.length)}return n})),this._instanceUse("request",this._useRequestCallback.bind(this)),this._interceptorUse()}return this.instance},e.prototype.getServerInstance=function(){return cn("getServerInstance"),this.getInstance()},e.prototype.reportV2=function(e,t){return i(this,void 0,void 0,(function(){var n,i,s,c,u,d,p,l,f,v,h,g,m,y,_,w,b,S,k,T,O,L,I,x,E,R,P,D,A,C,N,M,j,U,H,V,F,B,q,G,z;return a(this,(function(a){return i=(n=t||{}).immediately,s=n.isHttpReport,c=n.reportNow,u=n.ignoreLanding,d=void 0!==u&&u,p=n.actFields,l=e.app_id,f=e.http_cookie,v=e.session_id,h=e.session_create_time,g=e.session_rn,m=e.last_session_id,y=e.session_create_type,_=e.store_id,w=e.action_type,b=void 0===w?et:w,S=e.module,k=void 0===S?et:S,T=e.page,O=void 0===T?et:T,L=e.component,I=void 0===L?et:L,x=e.store_timezone,E=e.user_timezone,R=e.store_region,P=e.event_created_at_ms,D=e.device_token,A=e.ua_info,C=e.event_id,N=e.event_name,M=e.data_id,j=e.moreinfo,U=void 0===j?{}:j,H=o(e,["app_id","http_cookie","session_id","session_create_time","session_rn","last_session_id","session_create_type","store_id","action_type","module","page","component","store_timezone","user_timezone","store_region","event_created_at_ms","device_token","ua_info","event_id","event_name","data_id","moreinfo"]),V=Se(H,rt),F=Se(U,rt),B=d?0:this._getSessionCreateDataId({sid:v,isCollect:!0}),q=r(r(r(r({project_id:$e,app_id:l,act:Xe,http_cookie:f,session_id:v,session_create_time:h,session_rn:g,last_session_id:m,session_create_type:y,store_id:_,action_type:b,module:k,page:O,component:I,store_timezone:x,user_timezone:E,store_region:R,event_created_at_ms:P,event_id:C,event_name:N,device_token:D,ua_info:A,env:this.options.env},F),V),p),{moreinfo:r(r(r({},U),H),{session_create_data_id:B})}),(G=this._formatReportParams(q)).is_server=0,this.debugMode&&(console.groupCollapsed("Tracker Debug(reportV2):Wait Mode:".concat(this.options.wait,".event_id:").concat(C," immediately:").concat(!!i," isHttpReport:").concat(!!s," reportNow:").concat(!!c)),console.table(e),console.groupEnd()),-1===tt.indexOf(this.options.env)?[2,Promise.resolve()]:(M&&(G.$data_id=M),z=this.getInstance(),[2,this._instanceReport(z,G,t)])}))}))},e.prototype._pluginReport=function(t,n){return i(this,void 0,void 0,(function(){var i,s,c,u,d,p,l,f,v,h,g,m,y,_;return a(this,(function(a){switch(a.label){case 0:return i=this.getOptions(),s=i.env,c=i.beforeSend,-1===tt.indexOf(s)?[2,Promise.resolve()]:(u=t.app_id,d=t.event_id,p=t.event_name,l=t.event_ext_info,f=o(t,["app_id","event_id","event_name","event_ext_info"]),v={},c&&"function"==typeof c?[4,c(v)]:[3,2]);case 1:v=a.sent(),a.label=2;case 2:return h=on.getSession().value,g=r({screen_height:on.getScreenHeight(),screen_width:on.getScreenWidth(),store_timezone:v.store_timezone,user_id:on.getUserId(),user_timezone:v.user_timezone},f),m={event_created_at_ms:+new Date,event_id:d,event_name:p},l&&(m.event_ext_info=e.encodeParams(l)),y={app_id:u,act:Qe,env:s,http_cookie:on.getHttpCookie(),merchant_id:on.getMerchantId(),moreinfo:g,event_info:m,store_id:on.getStoreId(),uuid:v.iframe_id,version:an,session_id:(null==h?void 0:h.sid)||"",session_create_time:(null==h?void 0:h.createAt)||"",session_create_type:(null==h?void 0:h.session_create_type)||"",last_session_id:(null==h?void 0:h.last_session_id)||"",__fromPlugin__:1},_=this.getInstance(),[2,this._instanceReport(_,y,n)]}}))}))},e.prototype._instanceReport=function(e,t,n){var r=n||{},o=r.isHttpReport,i=r.reportNow,a=r.immediately,s=o?null==e?void 0:e.httpInstance.report(t,i):null==e?void 0:e.report(t,i);return a&&e.post(),s},e.prototype._formatReportParams=function(t){var n=e.encodeParams(t),r=t.moreinfo||{};return n.moreinfo=JSON.stringify(r),n},e.prototype.reportJudge=function(){return cn("reportJudge"),Promise.resolve()},e.prototype.getDataId=function(){return v()},e.prototype.setServerRn=function(){cn("setServerRn")},e.prototype._getSessionCreateDataId=function(e){var t,n,r=e.sid,o=e.isCollect,i=void 0!==o&&o,a=qe.get(nt),s=(null==a?void 0:a[r])||[];if(!s||!Array.isArray(s))return 0;var c=s[0],u=s[1];return i&&!u?(qe.set(nt,((t={})[r]=[c,1],t)),1):i||c?0:(qe.set(nt,((n={})[r]=[1,u],n)),1)},e.encodeParams=function(e){return Object.keys(e).reduce((function(t,n){try{t[n]=encodeURIComponent(e[n]||"")}catch(r){console.error("[tracker] encodeURIComponent params error:",r),t[n]=e[n]}return t}),{})},e}(),dn=function(){function e(){this.groups={}}return e.prototype.add=function(e,t){(this.groups[e]||(this.groups[e]=new Set)).add(t)},e.prototype.entries=function(){return Object.entries(this.groups)},e.prototype.clear=function(){this.groups={}},e}(),pn=function(){function e(){this.nextTickId=null,this.onTick=function(){},this.intervalMs=10,this.looping=!1}return e.prototype.start=function(e,t){var n=this;this.stop(),this.onTick=e,this.intervalMs=Math.max(10,t),this.looping=!0;i(n,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return[4,this.nextTick(this.intervalMs)];case 1:return e.sent(),this.onTick(),[3,0];case 2:return[2]}}))}))},e.prototype.tick=function(){this.onTick(),this.looping&&this.start(this.onTick,this.intervalMs)},e.prototype.stop=function(){this.nextTickId&&window.clearTimeout(this.nextTickId),this.looping=!1},e.prototype.nextTick=function(e){return i(this,void 0,void 0,(function(){var t=this;return a(this,(function(n){return[2,new Promise((function(n){t.nextTickId=window.setTimeout(n,e)}))]}))}))},e}();!function(e){e[e.Uninit=0]="Uninit",e[e.Inited=1]="Inited"}(Ce||(Ce={}));var ln=function(){function e(e,t){void 0===t&&(t={}),this.htmlElementGroups=new dn,this.asyncLoop=new pn,this.exposedElements=new Set,this.collect=null,this.state=Ce.Uninit,this.effectRemovalSet=new Set,(null===window||void 0===window?void 0:window.SL_Report)||(window.SL_Report={}),window.SL_Report.exposeMap||(window.SL_Report.exposeMap=new Map,this.effectRemovalSet.add((function(){window.SL_Report.exposeMap&&(window.SL_Report.exposeMap.clear(),delete window.SL_Report.exposeMap)}))),this.collect=e,this.options=t}return e.prototype.init=function(){this.initExposeObserver(),this.initExposeAsyncLoop(),this.state=Ce.Inited},e.prototype.initExposeObserver=function(){var e=this,t={threshold:Array.from(Array(11).keys()).map((function(e){return e/10})),root:null,rootMargin:"0px"};window.SL_Report.exposeObserver=new IntersectionObserver((function(t){t.forEach((function(t){var n,r,o=t.isIntersecting,i=t.intersectionRatio,a=t.boundingClientRect,s=t.time,c=t.target,u=c.dataset.__trackerSelector||"",d=(null===(n=window.SL_Report.exposeMap)||void 0===n?void 0:n.get(u))||{},p=d.view,l=d.viewSuccess,f=(l||{}).threshold,v=void 0===f?.5:f,h=a.height>window.innerHeight;h&&(c.dataset.__trackerSuperLong="1"),o&&l&&(i>=v||h)?c.dataset.__trackerViewSucceed||c.dataset.__trackerViewSuccessOnce||(c.dataset.__trackerLastViewStarted=String(s),c.dataset.__trackerViewSucceed="1",e.exposedElements.add(c),(null===(r=window.SL_Report)||void 0===r?void 0:r.exposeTimer)||e.checkTimer({element:c})):(e.resetTime(c),delete c.dataset.__trackerViewSucceed,e.exposedElements.delete(c)),o&&p&&i>=0?c.dataset.__trackerViewed||c.dataset.__trackerViewOnce||(e.reportView(c,p),c.dataset.__trackerViewed="1",p.reportOnce&&(c.dataset.__trackerViewOnce="1")):delete c.dataset.__trackerViewed}))}),t),this.effectRemovalSet.add((function(){window.SL_Report.exposeObserver&&(window.SL_Report.exposeObserver.disconnect(),delete window.SL_Report.exposeObserver)})),this.effectRemovalSet.add((function(){window.SL_Report.exposeTimer&&(clearTimeout(window.SL_Report.exposeTimer),delete window.SL_Report.exposeTimer)}))},e.prototype.initExposeAsyncLoop=function(){var e=this;this.asyncLoop.start((function(){var t=window.SL_Report.exposeMap;if(t){for(var n=0,r=e.htmlElementGroups.entries();n<r.length;n++){var o=r[n],i=o[0],a=o[1],s=t.get(i);if(s&&s.viewSuccess&&s.viewSuccess.batch&&a.size>0)try{e.reportViewSuccess(Array.from(a),s.viewSuccess)}catch(e){}}e.htmlElementGroups.clear()}}),this.options.asyncLoopInterval||5e3);var t=function(){"hidden"===document.visibilityState&&e.asyncLoop.tick()};document.addEventListener("visibilitychange",t);var n=function(){e.asyncLoop.tick()};window.addEventListener("pagehide",n),this.effectRemovalSet.add((function(){return e.asyncLoop.stop()})),this.effectRemovalSet.add((function(){return document.removeEventListener("visibilitychange",t)})),this.effectRemovalSet.add((function(){return window.removeEventListener("pagehide",n)}))},e.prototype.reportView=function(e,t){var n,o=(t||{}).params,i=void 0===o?{}:o;"function"==typeof i&&(i=i(e)),null===(n=this.collect)||void 0===n||n.call(this,r({event_name:"View",action_type:101},i))},e.prototype.reportViewSuccess=function(e,t){var n,o=(t||{}).params,i=void 0===o?{}:o;"function"==typeof t.params&&(t.batch&&Array.isArray(e)?i=t.params(e):t.batch||Array.isArray(e)||(i=t.params(e))),null===(n=this.collect)||void 0===n||n.call(this,r({event_name:"ViewSuccess",action_type:108},i),{reportNow:t.batch})},e.prototype.track=function(e){var t=this,n=e.selector,r=e.targetList;if(n||(null==r?void 0:r.length)){this.state===Ce.Uninit&&this.init();var o=Math.random().toString(32).slice(2),i=r?'[data-__tracker-id="'.concat(o,'"]'):n,a=window.SL_Report,s=a.exposeObserver,c=a.exposeMap;this.checkTimer({options:e}),(r||document.querySelectorAll(n)).forEach((function(e){t.resetTime(e),e.dataset.__trackerSelector=i||n,(null==r?void 0:r.length)&&(e.dataset.__trackerId=o),s.observe(e)})),c.set(i,e)}},e.prototype.dispose=function(){this.effectRemovalSet.forEach((function(e){return e()}))},e.prototype.checkTimer=function(e){var t,n=this,r=e.element,o=e.options;if(window.SL_Report.exposeMap){var i=o;if(!i){var a=(null==r?void 0:r.dataset.__trackerSelector)||"";i=window.SL_Report.exposeMap.get(a)}var s=this.getTimeout(i);clearTimeout(null===(t=window.SL_Report)||void 0===t?void 0:t.exposeTimer);var c=function(){window.SL_Report.exposeTimer=window.setTimeout((function(){!n.handleRefreshTimeout()&&c()}),s)};c()}},e.prototype.handleRefreshTimeout=function(){var e=this;if(!this.exposedElements.size)return clearTimeout(window.SL_Report.exposeTimer),delete window.SL_Report.exposeTimer,!0;var t=window.SL_Report,n=t.exposeMap,r=t.exposeObserver;n&&this.exposedElements.forEach((function(t){var o=t.dataset,i=o.__trackerTotalViewTime,a=void 0===i?0:i,s=o.__trackerSelector,c=void 0===s?"":s,u=o.__trackerSuperLong,d=document.querySelectorAll(c);if(!Array.from(d).some((function(e){return e===t})))return e.exposedElements.delete(t),void r.unobserve(t);var p=(n.get(c)||{}).viewSuccess,l=void 0===p?{}:p,f=l.threshold,v=void 0===f?.5:f;if(u){var h=t.getBoundingClientRect(),g=h.top,m=h.height;if(g+m<0)return e.resetTime(t);if((window.innerHeight-g)/m<v)return e.resetTime(t)}e.updateExposeTimer(t),+a>=(l.duration||300)&&(l.batch?e.htmlElementGroups.add(c,t):e.reportViewSuccess(t,l),e.resetTime(t),e.exposedElements.delete(t),l.reportOnce&&(t.dataset.__trackerViewSuccessOnce="1"))}))},e.prototype.updateExposeTimer=function(e){var t=+(e.dataset.__trackerLastViewStarted||0),n=performance.now();if(t){var r=n-t;e.dataset.__trackerTotalViewTime=String(parseFloat(e.dataset.__trackerTotalViewTime)+r)}e.dataset.__trackerLastViewStarted=String(n)},e.prototype.getTimeout=function(e){var t,n=window.SL_Report.exposeMap;if(!n)return 1e3;var r=Array.from(n.values()).map((function(e){var t;return((null===(t=e.viewSuccess)||void 0===t?void 0:t.duration)||300)/2})),o=Math.min.apply(Math,s(s([],r,!1),[1e3,((null===(t=null==e?void 0:e.viewSuccess)||void 0===t?void 0:t.duration)||300)/2],!1));return o>100?o:100},e.prototype.resetTime=function(e){e.dataset.__trackerTotalViewTime="0",e.dataset.__trackerLastViewStarted="0"},e}();var fn=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)},vn="object"==typeof M&&M&&M.Object===Object&&M,hn="object"==typeof self&&self&&self.Object===Object&&self,gn=vn||hn||Function("return this")(),mn=function(){return gn.Date.now()},yn=/\s/;var _n=function(e){for(var t=e.length;t--&&yn.test(e.charAt(t)););return t},wn=/^\s+/;var bn=function(e){return e?e.slice(0,_n(e)+1).replace(wn,""):e},Sn=gn.Symbol,kn=Object.prototype,Tn=kn.hasOwnProperty,On=kn.toString,Ln=Sn?Sn.toStringTag:void 0;var In=function(e){var t=Tn.call(e,Ln),n=e[Ln];try{e[Ln]=void 0;var r=!0}catch(e){}var o=On.call(e);return r&&(t?e[Ln]=n:delete e[Ln]),o},xn=Object.prototype.toString;var En=function(e){return xn.call(e)},Rn=Sn?Sn.toStringTag:void 0;var Pn=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":Rn&&Rn in Object(e)?In(e):En(e)};var Dn=function(e){return null!=e&&"object"==typeof e};var An=function(e){return"symbol"==typeof e||Dn(e)&&"[object Symbol]"==Pn(e)},Cn=/^[-+]0x[0-9a-f]+$/i,Nn=/^0b[01]+$/i,Mn=/^0o[0-7]+$/i,jn=parseInt;var Un=function(e){if("number"==typeof e)return e;if(An(e))return NaN;if(fn(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=fn(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=bn(e);var n=Nn.test(e);return n||Mn.test(e)?jn(e.slice(2),n?2:8):Cn.test(e)?NaN:+e},Hn=Math.max,Vn=Math.min;var Fn=function(e,t,n){var r,o,i,a,s,c,u=0,d=!1,p=!1,l=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function f(t){var n=r,i=o;return r=o=void 0,u=t,a=e.apply(i,n)}function v(e){return u=e,s=setTimeout(g,t),d?f(e):a}function h(e){var n=e-c;return void 0===c||n>=t||n<0||p&&e-u>=i}function g(){var e=mn();if(h(e))return m(e);s=setTimeout(g,function(e){var n=t-(e-c);return p?Vn(n,i-(e-u)):n}(e))}function m(e){return s=void 0,l&&r?f(e):(r=o=void 0,a)}function y(){var e=mn(),n=h(e);if(r=arguments,o=this,c=e,n){if(void 0===s)return v(c);if(p)return clearTimeout(s),s=setTimeout(g,t),f(c)}return void 0===s&&(s=setTimeout(g,t)),a}return t=Un(t)||0,fn(n)&&(d=!!n.leading,i=(p="maxWait"in n)?Hn(Un(n.maxWait)||0,t):i,l="trailing"in n?!!n.trailing:l),y.cancel=function(){void 0!==s&&clearTimeout(s),u=0,r=c=o=s=void 0},y.flush=function(){return void 0===s?a:m(mn())},y};var Bn=function(e,t,n){var r=!0,o=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return fn(n)&&(r="leading"in n?!!n.leading:r,o="trailing"in n?!!n.trailing:o),Fn(e,t,{leading:r,maxWait:t,trailing:o})},qn=function(){function e(e){var t=this;this.totalDuration=0,this.currPeriodDuration=0,this.currPeriodStart=0,this.isPageleft=!1,this.opts=e,this.report=function(n,r){return i(t,void 0,void 0,(function(){var t;return a(this,(function(o){switch(o.label){case 0:if(this.isPageleft)return[2];o.label=1;case 1:return o.trys.push([1,3,,4]),[4,e.report(n,r)];case 2:return o.sent(),[3,4];case 3:return t=o.sent(),Te("[PageHideTracker] Failed to report. data: ".concat(JSON.stringify(n)),g(t)),[3,4];case 4:return[2]}}))}))}}return e.prototype.updateDuration=function(){var e=this.currPeriodStart,t=(Date.now()-e)/1e3;(Number.isNaN(t)||t<0)&&(t=0),t=Number(t.toFixed(3)),t=Math.min(t,1800),this.currPeriodDuration=t,this.totalDuration+=t},e.prototype.getInternalReportData=function(e){this.updateDuration();var t=e.trigger_by,n=o(e,["trigger_by"]),i=r(r({},n),{event_name:"PageDuration",event_duration:this.currPeriodDuration});if(this.opts.moreInfoDebugEnabled){var a={total_duration:this.totalDuration,trigger_by:t};i=r(r({},i),a)}return i},e.prototype.startNewPeriod=function(){this.isPageleft=!1,this.currPeriodStart=Date.now()},e.prototype.reportOnHide=function(){return i(this,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return[4,this.report(this.getInternalReportData({trigger_by:"hide"}),{})];case 1:return e.sent(),[2]}}))}))},e.prototype.reportOnLeave=function(e,t){return i(this,void 0,void 0,(function(){var n;return a(this,(function(o){return n=this.report(r(r({},this.getInternalReportData(t)),e),{}),this.isPageleft=!0,[2,n]}))}))},e.prototype.reportOnSessionChange=function(e){return i(this,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return[4,this.report(this.getInternalReportData({trigger_by:"sessionChange"}),e)];case 1:return t.sent(),[2]}}))}))},e}();var Gn,zn,Jn=function(){function e(e){var t=this;this.asyncLoop=new pn,this.currPeriodDuration=0,this.currPeriodStart=0,this.isPageLeave=!1,this.pageDurationGroups=[],this.opts=e,this.addReportGroups=function(e){return i(t,void 0,void 0,(function(){return a(this,(function(t){return this.isPageLeave||this.pageDurationGroups.push(e),[2]}))}))},this.report=function(n){return i(t,void 0,void 0,(function(){var t;return a(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,e.report(n)];case 1:return r.sent(),[3,3];case 2:return t=r.sent(),Te("[PageHideTracker] Failed to report. data: ".concat(JSON.stringify(n)),g(t)),[3,3];case 3:return[2]}}))}))},this.initAsyncLoop()}return e.prototype.initAsyncLoop=function(){var e=this;this.asyncLoop.start((function(){var t=e.pageDurationGroups.length,n=e.pageDurationGroups[t-1];if(n){var o=e.pageDurationGroups.reduce((function(e,t){return e+t.event_duration}),0);o=Number(o.toFixed(3)),e.report(r(r({},n),{event_duration:o})),e.pageDurationGroups=[]}}),this.opts.asyncLoopInterval||3e3)},e.prototype.updateDuration=function(){var e=this.currPeriodStart,t=(Date.now()-e)/1e3;(Number.isNaN(t)||t<0)&&(t=0),t=Number(t.toFixed(3)),t=Math.min(t,1800),this.currPeriodDuration=t},e.prototype.getInternalReportData=function(){return this.updateDuration(),{event_name:"PageDurationWithPageLeave",event_duration:this.currPeriodDuration}},e.prototype.startNewPeriod=function(){this.isPageLeave=!1,this.currPeriodStart=Date.now()},e.prototype.reportOnHide=function(){return i(this,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return[4,this.addReportGroups(this.getInternalReportData())];case 1:return e.sent(),[2]}}))}))},e.prototype.reportOnLeave=function(e,t){return i(this,void 0,void 0,(function(){return a(this,(function(n){switch(n.label){case 0:return this.addReportGroups(r(r(r(r({},this.getInternalReportData()),e),t),{is_pageleave:1})),this.isPageLeave=!0,[4,this.asyncLoop.tick()];case 1:return n.sent(),[2,Promise.resolve()]}}))}))},e.prototype.reportOnSessionChange=function(){return i(this,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return[4,this.addReportGroups(this.getInternalReportData())];case 1:return e.sent(),[2]}}))}))},e.prototype.dispose=function(){this.asyncLoop.stop()},e}();var Yn=ct&&(null===(zn=null===(Gn=window.__ENV__)||void 0===Gn?void 0:Gn.ANALYTICS_UNIFY_CONFIG)||void 0===zn?void 0:zn.greyLog);var Kn=new(function(e){function n(){var t,n,o,s,c=this;return(c=e.call(this)||this).maxScrollTop=0,c.skipOnSessionUpdate=!1,c.beginSessionId="",c.heartbeatIds=[],c.exposeInstance=null,c.destUrlLock=!1,c.pageLeaveLock=!1,c.pageDurationAndLeaveTracker=null,c.pageDurationTracker=function(e){var t,n,o,i;return new qn(r(r({},e),{moreInfoDebugEnabled:!!(null===(o=null===(n=null===(t=window.__ENV__)||void 0===t?void 0:t.ANALYTICS_UNIFY_CONFIG)||void 0===n?void 0:n.pageHideGreyStoreIds)||void 0===o?void 0:o.includes(null===(i=window.Shopline)||void 0===i?void 0:i.storeId))}))}({report:function(e,t){return i(c,void 0,void 0,(function(){var n,o;return a(this,(function(i){switch(i.label){case 0:return n=this.beginSessionId||on.getRawSessionId(),o=this.getMaxHeightParams(),[4,this.collect(r(r(r({},o),e),{begin_session:n}),r(r({},t),{reportNow:!0}))];case 1:return i.sent(),[2]}}))}))}}),(null===(t=window.SL_Report)||void 0===t?void 0:t.isHitPageDurationGray)&&(c.pageDurationAndLeaveTracker=(s={report:function(e){return i(c,void 0,void 0,(function(){var t,n;return a(this,(function(o){switch(o.label){case 0:return t=this.beginSessionId||on.getRawSessionId(),n=this.getMaxHeightParams(),[4,this.collect(r(r(r({},n),e),{begin_session:t}),{reportNow:!0})];case 1:return o.sent(),[2]}}))}))},asyncLoopInterval:null===(n=c.getOptions())||void 0===n?void 0:n.pageDurationAsyncLoopInterval},new Jn(r({},s)))),(null===(o=window.SL_Report)||void 0===o?void 0:o.skipSelfInit)||c.init(),c}return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}(n,e),n.prototype.setMode=function(e){"debug"===e?this.setDebugMode(!0):this.setDebugMode(!1)},n.prototype.getBaseParams=function(e){return i(this,void 0,void 0,(function(){var t,n,r,o,i,s,c,u,d,p,l,f,v,h,g,m;return a(this,(function(a){switch(a.label){case 0:return 1,t=this.getOptions(),n=t.timezoneOffset,r=void 0===n?0:n,o=t.handleBaseParams,i=t.disableIframeId,s=t.timeOffset,c=void 0===s?0:s,d=(u=e||{}).ignoreSession,p=void 0!==d&&d,l=u.ignoreSessionRn,f=void 0!==l&&l,v=u.session,h={version:an,iframe_id:1,http_cookie:on.getHttpCookie(),url_path:on.getUrlPath(),language:on.getLanguage(),is_mobile:on.getIsMobile(),merchant_id:on.getMerchantId(),user_id:on.getUserId(),http_search:on.getHttpSearch(),title:on.getTitle(),store_id:on.getStoreId(),website:on.getWebsite(),loading_time:on.getPerformance().load,event_created_at_ms:+new Date,screen_width:on.getScreenWidth(),screen_height:on.getScreenHeight()},p||(g=(null==v?void 0:v.sid)?v:on.getSessionId(30,r,c),m=f?void 0:on.upsetSessionRn(g),h.session_id=g.sid,h.session_create_time=g.createAt,h.session_rn=m,h.last_session_id=g.last_session_id,h.session_create_type=g.session_create_type),i&&delete h.iframe_id,o&&"function"==typeof o?[4,o(h)]:[3,2];case 1:a.sent(),a.label=2;case 2:return[2,h]}}))}))},n.prototype.setDefaultEventId=function(e){var t=e.event_name,n=void 0===t?"":t,o=e.event_id,i=e.action_type;if(y.includes(n)){var a=et,s=o||"",c=/^([a-zA-Z]+)(.*)$/.exec(s);if(s)if(c){var u=c[1],d=c[2];u&&d&&(s="".concat(function(e){var t;if(!(null===(t=null==e?void 0:e.trim)||void 0===t?void 0:t.call(e)))return e;var n="string"==typeof e?e:"".concat(e);return n.charAt(0).toUpperCase()+n.slice(1)}(u)).concat(ke(d)))}else s="".concat(n).concat(ke(s));else s="".concat(n,"_").concat(Date.now(),"_").concat(v().replace(/-/g,""));return _.includes(n)&&(a=i||a),r(r({},e),{action_type:a,event_id:s})}return e},n.prototype.collect=function(e,t){var n,o,s,c,u;return void 0===t&&(t={}),i(this,void 0,void 0,(function(){var i,d,p,l,f,v,h,y,_,w,b,S,k,T,O;return a(this,(function(a){switch(a.label){case 0:return a.trys.push([0,7,,8]),navigator.userAgent.indexOf("SL2ShopperApp")>-1?[2,this.shopperAppReport(e)]:this.validateParams(r(r({act:Xe},e),null==t?void 0:t.actFields))?(i=this.getOptions(),d=i.beforeSend,p=i.onSessionUpdate,l=i.timezoneOffset,f=i.timeOffset,v=i.addStatInfoToMoreinfo,h=(null===(n=qe.getRaw(ze))||void 0===n?void 0:n.value)||null,y=qe.isExpired(ze),_=String(e.action_type||"")===m,[4,this.getBaseParams({ignoreSession:t.ignoreSession,ignoreSessionRn:_})]):[2,Promise.resolve()];case 1:return w=a.sent(),b=r(r({page_alias:null===(s=null===(o=window.Shopline)||void 0===o?void 0:o.uri)||void 0===s?void 0:s.alias},w),this.setDefaultEventId(e)),d&&"function"==typeof d?[4,d(b)]:[3,3];case 2:b=a.sent(),a.label=3;case 3:if(v&&"function"==typeof v&&(b=v(b)),Yn)try{S=(null===(c=vt.getRaw(dt))||void 0===c?void 0:c.value)||{},b.__session=JSON.stringify(S),k=null===(u=qe.getRaw(ut))||void 0===u?void 0:u.value,b.__beginSessionId=this.beginSessionId,b.__bakCid=k,b.__storageType=pt,b.__lsLength=localStorage.length,b.__ssLength=sessionStorage.length,b.__cookieLength=document.cookie.length}catch(e){Te("greyLog error",e)}return!this.skipOnSessionUpdate&&y&&h&&"function"==typeof p?(T=on.getSessionId(30,l,f),this.skipOnSessionUpdate=!0,[4,p(h,T)]):[3,5];case 4:a.sent(),this.skipOnSessionUpdate=!1,a.label=5;case 5:return t.ignoreLanding=_,[4,this.reportV2(b,t)];case 6:return[2,a.sent()];case 7:throw O=a.sent(),this.skipOnSessionUpdate=!1,Te("[CollectError] sessionId: ".concat(on.getSessionId().sid),g(O)),O;case 8:return[2]}}))}))},n.prototype._pluginReport=function(t,n){return i(this,void 0,void 0,(function(){return a(this,(function(o){return this.validateParams(r(r({},t),{act:Qe}))?Object.entries(b).every((function(e){var n=e[0];return(0,e[1])(t[n])}))?[2,e.prototype._pluginReport.call(this,t,n)]:(console.error("plugin report params is invalid",t),[2,Promise.resolve()]):[2,Promise.resolve()]}))}))},n.prototype.shopperAppReport=function(e){var t,n,i=e||{},a=i.event_name,s=i.moreinfo,c=o(i,["event_name","moreinfo"]);return a&&w.includes(a)&&(null===(n=null===(t=window.shoplineAppBridge)||void 0===t?void 0:t.shopper2)||void 0===n||n.call(t,"logStatEvent",{eventName:a,eventMap:JSON.stringify({moreinfo:r(r({},s),c)})})),Promise.resolve()},n.prototype.report=function(){return i(this,void 0,void 0,(function(){return a(this,(function(e){return[2,Promise.resolve()]}))}))},n.prototype.init=function(){var e,t,n=this;if("undefined"!=typeof window&&(window.SL_Report=window.SL_Report||{},!(null===(e=window.SL_Report)||void 0===e?void 0:e.init))){window.SL_Report.init=!0;var r,o,s=function(e){var t=Array.from(e),r=t[0],o=t.slice(1),i=n[r];"function"==typeof i&&i.apply(n,o)},c="setOptions";try{(r=window.SL_Report.queue||[],o=c,null==r?void 0:r.filter((function(e){return e[0]===o}))).forEach(s),null===(t=window.SL_Report.queue)||void 0===t||t.forEach((function(e){return e[0]!==c&&s(e)})),window.SL_Report.queue=[]}catch(e){console.error(e)}!function(e){function t(){"loading"!==document.readyState&&setTimeout(e,0),document.removeEventListener("DOMContentLoaded",t),document.removeEventListener("readystatechange",t)}document.removeEventListener("DOMContentLoaded",e),document.removeEventListener("readystatechange",e),"loading"===document.readyState?(document.addEventListener("DOMContentLoaded",t),document.addEventListener("readystatechange",t)):setTimeout(e,0)}((function(){n.pageView()}));var u,d,p=Bn((function(){return n.recordScrollTop()}),100);u=p,window.removeEventListener("scroll",u),window.addEventListener("scroll",u,!1),function(e){window.removeEventListener("beforeunload",e),window.addEventListener("beforeunload",e)}((function(e){var t,r,o;if("A"===(null===(r=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.activeElement)||void 0===r?void 0:r.tagName))return!1;var i={end_session:on.getRawSessionId()};return n.pageDurationTracker.reportOnLeave(i,{trigger_by:"beforeunload"}),null===(o=n.pageDurationAndLeaveTracker)||void 0===o||o.reportOnLeave(i,n.getPageLeaveParams()),n.pageLeave()})),function(e){window.removeEventListener("pagehide",e),window.addEventListener("pagehide",e)}((function(){var e,t={end_session:on.getRawSessionId()};n.pageDurationTracker.reportOnLeave(t,{trigger_by:"pagehide"}),null===(e=n.pageDurationAndLeaveTracker)||void 0===e||e.reportOnLeave(t,n.getPageLeaveParams())})),{visibleHandler:h((d={visible:function(){var e;n.pageDurationTracker.startNewPeriod(),null===(e=n.pageDurationAndLeaveTracker)||void 0===e||e.startNewPeriod()},hidden:function(){var e;n.pageDurationTracker.reportOnHide(),null===(e=n.pageDurationAndLeaveTracker)||void 0===e||e.reportOnHide()}}).visible)?d.visible:function(){},hiddenHandler:h(d.hidden)?d.hidden:function(){},visibilityChange:"",hidden:"",isSupport:function(){return void 0!==document[this.hidden]},init:function(){void 0!==document.hidden?(this.hidden="hidden",this.visibilityChange="visibilitychange"):void 0!==document.mozHidden?(this.hidden="mozHidden",this.visibilityChange="mozvisibilitychange"):void 0!==document.msHidden?(this.hidden="msHidden",this.visibilityChange="msvisibilitychange"):void 0!==document.webkitHidden&&(this.hidden="webkitHidden",this.visibilityChange="webkitvisibilitychange"),this.listen()},listen:function(){if(this.isSupport()){var e=this;document.addEventListener(this.visibilityChange,(function(){document[e.hidden]?e.hiddenHandler():e.visibleHandler()}),!0)}else window.addEventListener("focus",this.visibleHandler),window.addEventListener("blur",this.hiddenHandler)}}.init();document.addEventListener("click",(function(e){var t;if(!n.destUrlLock)for(var r=function(e){if(e.path)return e.path;if("function"==typeof e.composedPath)return e.composedPath();for(var t=[],n=e.target;n&&null!==n.parentNode;)t.push(n),n=n.parentNode;return t.push(document,window),t}(e),o=r.length-1;o>=0;o--){var i=r[o];if(i&&1===i.nodeType&&"a"===i.nodeName.toLowerCase()&&/^https?:\/\//.test(i.href)){var a={end_session:on.getRawSessionId(),page_dest_url:i.href};n.pageDurationTracker.reportOnLeave(a,{trigger_by:"click"}),null===(t=n.pageDurationAndLeaveTracker)||void 0===t||t.reportOnLeave(a,n.getPageLeaveParams()),n.pageLeave({params:{page_dest_url:i.href}}),n.pageLeaveLock=!0,setTimeout((function(){n.pageLeaveLock=!1}),100);break}}})),this.setOptions({onSessionUpdate:function(e){return i(n,void 0,void 0,(function(){var t;return a(this,(function(n){return null===(t=this.pageDurationAndLeaveTracker)||void 0===t||t.reportOnSessionChange(),[2,this.pageDurationTracker.reportOnSessionChange({session:e})]}))}))}})}},n.prototype.pageView=function(e){var t,n=void 0===e?{}:e,o=n.params,s=n.session;return i(this,void 0,void 0,(function(){return a(this,(function(e){return this.pageDurationTracker.startNewPeriod(),null===(t=this.pageDurationAndLeaveTracker)||void 0===t||t.startNewPeriod(),on.getWebVitals(),this.beginSessionId=(null==s?void 0:s.sid)||on.getRawSessionId(),[2,this.collect(r({event_name:"PageView"},o),{session:s})]}))}))},n.prototype.getPageLeaveParams=function(e){var t=this.getMaxHeightParams();return r(r(r({},t),e),on.webVitals)},n.prototype.pageLeave=function(e){var t,n=void 0===e?{}:e,o=n.params,s=n.session;return i(this,void 0,void 0,(function(){var e,n,i,c;return a(this,(function(a){return this.pageLeaveLock?[2,Promise.resolve()]:(e=this.collect(r({event_name:"PageLeave"},this.getPageLeaveParams(o)),{session:s}),n={end_session:on.getRawSessionId()},i=this.pageDurationTracker.reportOnLeave(n,{trigger_by:"pageleave"}),c=(null===(t=this.pageDurationAndLeaveTracker)||void 0===t?void 0:t.reportOnLeave(n,this.getPageLeaveParams(o)))||Promise.resolve(),this.destroy(),[2,Promise.all([e,i,c])])}))}))},n.prototype.heartbeat=function(e,t){return void 0===t&&(t=2e3),i(this,void 0,void 0,(function(){var n,o=this;return a(this,(function(i){return n=window.setInterval((function(){o.collect(r({event_name:"HeartBeat"},e)),o.heartbeatIds.push(n)}),t),[2]}))}))},n.prototype.expose=function(e){return i(this,void 0,void 0,(function(){return a(this,(function(t){return this.exposeInstance||(this.exposeInstance=new ln(this.collect.bind(this),{asyncLoopInterval:this.getOptions().exposeAsyncLoopInterval})),this.exposeInstance.track(e),[2]}))}))},n.prototype.onPageChange=function(e,t){return i(this,void 0,void 0,(function(){var n=this;return a(this,(function(r){return this.destUrlLock=!0,setTimeout((function(){n.destUrlLock=!1}),100),[2,Promise.all([this.pageLeave({params:e}),this.pageView({params:t})])]}))}))},n.prototype.recordScrollTop=function(){var e=document.documentElement.scrollTop;e>this.maxScrollTop&&(this.maxScrollTop=e)},n.prototype.getMaxHeightParams=function(){var e=document.documentElement||document.body,t=e?((this.maxScrollTop+e.clientHeight)/(null==e?void 0:e.scrollHeight)*100).toFixed(2):0;return{max_height:this.maxScrollTop,max_height_pc:t}},n.prototype.destroy=function(){var e;this.maxScrollTop=0,this.skipOnSessionUpdate=!1,this.beginSessionId="",this.heartbeatIds.forEach((function(e){return clearInterval(e)})),this.heartbeatIds=[],(null===(e=window.SL_Report)||void 0===e?void 0:e.exposeObserver)&&(window.SL_Report.exposeObserver.disconnect(),window.SL_Report.exposeObserver=void 0)},n}(un));e.SDK_VERSION=an,e.baseParams=on,e.constants=gt,e.shopTracker=Kn,e.storage=qe,e.tracker=un,Object.defineProperty(e,"__esModule",{value:!0})}));
