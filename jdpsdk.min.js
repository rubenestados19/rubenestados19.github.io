!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).JdpSdk={})}(this,(function(t){"use strict";function e(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function r(t){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?e(Object(n),!0).forEach((function(e){s(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):e(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function i(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var a=t.apply(e,r);function c(t){o(a,n,i,c,u,"next",t)}function u(t){o(a,n,i,c,u,"throw",t)}c(void 0)}))}}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function c(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function u(t,e,r){return e&&c(t.prototype,e),r&&c(t,r),t}function s(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function f(t,e){if(null==t)return{};var r,n,o=function(t,e){if(null==t)return{};var r,n,o={},i=Object.keys(t);for(n=0;n<i.length;n++)r=i[n],e.indexOf(r)>=0||(o[r]=t[r]);return o}(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(n=0;n<i.length;n++)r=i[n],e.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(t,r)&&(o[r]=t[r])}return o}function l(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==r)return;var n,o,i=[],a=!0,c=!1;try{for(r=r.call(t);!(a=(n=r.next()).done)&&(i.push(n.value),!e||i.length!==e);a=!0);}catch(t){c=!0,o=t}finally{try{a||null==r.return||r.return()}finally{if(c)throw o}}return i}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return p(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return p(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function d(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function h(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function v(t,e,r){return e&&h(t.prototype,e),r&&h(t,r),t}function y(t,e){return(y=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function g(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&y(t,e)}function m(t){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function b(t,e){return!e||"object"!==m(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function w(t){return(w=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function k(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function _(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function O(t){return function(t){if(Array.isArray(t))return _(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return _(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function S(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function x(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){S(i,n,o,a,c,"next",t)}function c(t){S(i,n,o,a,c,"throw",t)}a(void 0)}))}}function R(t,e,r){return(R="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=w(t)););return t}(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(r):o.value}})(t,e,r||t)}function T(t,e){return t(e={exports:{}},e.exports),e.exports}var E=T((function(t){var e=function(t){var e,r=Object.prototype,o=r.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function f(t,e,r,n){var o=e&&e.prototype instanceof g?e:g,i=Object.create(o.prototype),a=new P(n||[]);return i._invoke=function(t,e,r){var n=p;return function(o,i){if(n===h)throw new Error("Generator is already running");if(n===v){if("throw"===o)throw i;return j()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var c=R(a,r);if(c){if(c===y)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===p)throw n=v,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=h;var u=l(t,e,r);if("normal"===u.type){if(n=r.done?v:d,u.arg===y)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n=v,r.method="throw",r.arg=u.arg)}}}(t,r,a),i}function l(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=f;var p="suspendedStart",d="suspendedYield",h="executing",v="completed",y={};function g(){}function m(){}function b(){}var w={};w[a]=function(){return this};var k=Object.getPrototypeOf,_=k&&k(k(I([])));_&&_!==r&&o.call(_,a)&&(w=_);var O=b.prototype=g.prototype=Object.create(w);function S(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function x(t,e){function r(i,a,c,u){var s=l(t[i],t,a);if("throw"!==s.type){var f=s.arg,p=f.value;return p&&"object"===n(p)&&o.call(p,"__await")?e.resolve(p.__await).then((function(t){r("next",t,c,u)}),(function(t){r("throw",t,c,u)})):e.resolve(p).then((function(t){f.value=t,c(f)}),(function(t){return r("throw",t,c,u)}))}u(s.arg)}var i;this._invoke=function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}}function R(t,r){var n=t.iterator[r.method];if(n===e){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=e,R(t,r),"throw"===r.method))return y;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return y}var o=l(n,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,y;var i=o.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,y):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function T(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function E(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function P(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(T,this),this.reset(!0)}function I(t){if(t){var r=t[a];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,i=function r(){for(;++n<t.length;)if(o.call(t,n))return r.value=t[n],r.done=!1,r;return r.value=e,r.done=!0,r};return i.next=i}}return{next:j}}function j(){return{value:e,done:!0}}return m.prototype=O.constructor=b,b.constructor=m,m.displayName=s(b,u,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,u,"GeneratorFunction")),t.prototype=Object.create(O),t},t.awrap=function(t){return{__await:t}},S(x.prototype),x.prototype[c]=function(){return this},t.AsyncIterator=x,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new x(f(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},S(O),s(O,u,"Generator"),O[a]=function(){return this},O.toString=function(){return"[object Generator]"},t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=I,P.prototype={constructor:P,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(E),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function n(n,o){return c.type="throw",c.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var u=o.call(a,"catchLoc"),s=o.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&o.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),E(r),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;E(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:I(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}(t.exports);try{regeneratorRuntime=e}catch(t){Function("r","regeneratorRuntime = r")(e)}}));function P(t){return JSON.parse(JSON.stringify(t))}var I,j="application/x-www-form-urlencoded",A=49152,D="The query length cannot exceed ".concat(48,"K"),C=new Uint8Array(16);function L(){if(!I&&!(I="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return I(C)}var M=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function U(t){return"string"==typeof t&&M.test(t)}for(var N=[],B=0;B<256;++B)N.push((B+256).toString(16).substr(1));function q(t,e,r){var n=(t=t||{}).random||(t.rng||L)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,e){r=r||0;for(var o=0;o<16;++o)e[r+o]=n[o];return e}return function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=(N[t[e+0]]+N[t[e+1]]+N[t[e+2]]+N[t[e+3]]+"-"+N[t[e+4]]+N[t[e+5]]+"-"+N[t[e+6]]+N[t[e+7]]+"-"+N[t[e+8]]+N[t[e+9]]+"-"+N[t[e+10]]+N[t[e+11]]+N[t[e+12]]+N[t[e+13]]+N[t[e+14]]+N[t[e+15]]).toLowerCase();if(!U(r))throw TypeError("Stringified UUID is invalid");return r}(n)}var H={useHttps:!0,useRetry:!0,retryTimes:1,maxRequest:5},J=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:H,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};d(this,t),this.configure(e),this.override(r)}return v(t,[{key:"configure",value:function(t){var e,r,n=Object.assign({},this.options,P(t));0<n.retryTimes&&n.retryTimes<4||(n.retryTimes=1),-1!==(null===(e=window.location)||void 0===e||null===(r=e.protocol)||void 0===r?void 0:r.indexOf("https"))&&(n.useHttps=!0),this.options=n}},{key:"merge",value:function(t){this.data=Object.assign({},this.data,t)}},{key:"override",value:function(t){this.data=P(t)}},{key:"use",value:function(t,e){if("function"==typeof e)switch(t){case"url":this.urlInterceptor=e;break;case"request":this.requestInterceptor=e}}},{key:"processTrackingData",value:function(t){var e=Object.assign({},this.data,t),r=this.completeTrackingData(e);return this.pretreateTrackingData(r)}},{key:"encodeTrackingData",value:function(t){var e,r=this.formatTrackingData(t);return"object"!==m(e=r)?e:function t(e,r){var n=[];if("object"===m(e))return Object.keys(e).forEach((function(o){var i=e[o];"object"===m(i)?n=""!=r?n.concat(t(i,r+"["+o+"]")):n.concat(t(i,o)):void 0!==i&&(""!=r?n.push(r,"[",o,"]","=",encodeURIComponent(i),"&"):n.push(o,"=",encodeURIComponent(i),"&"))})),n}(e,"").slice(0,-1).join("")}},{key:"completeTrackingData",value:function(t){var e,r,n,o,i,a,c,u={act:"websdkentmaster",time:Math.floor((new Date).getTime()/1e3),domain:null===(e=window)||void 0===e||null===(r=e.location)||void 0===r?void 0:r.hostname,url:null===(n=window)||void 0===n||null===(o=n.location)||void 0===o?void 0:o.href,ua:null===(i=window)||void 0===i||null===(a=i.navigator)||void 0===a?void 0:a.userAgent,ref:null===(c=document)||void 0===c?void 0:c.referrer,data_id:q(),request_time:Date.now()};return Object.assign({},u,t)}},{key:"formatMoreInfoData",value:function(t){var e,r={language:null===(e=window)||void 0===e?void 0:e.navigator.language,is_mobile:this.getIsMobile()};return Object.assign({},r,t)}},{key:"getMobile",value:function(){var t,e=null===(t=window)||void 0===t?void 0:t.navigator.userAgent,r=!e.match(/(iPad).*OS\s([\d_]+)/)&&e.match(/(iPhone\sOS)\s([\d_]+)/),n=e.match(/(Android)\s+([\d.]+)/);return r||n}},{key:"getIsMobile",value:function(){return this.getMobile()?"101":"102"}},{key:"pretreateTrackingData",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.options,r=this.requestInterceptor;return"function"==typeof r?r(t,e):t}},{key:"formatTrackingData",value:function(t){var e=P(t);return e.moreinfo||(e.moreinfo={}),"object"===m(e.moreinfo)&&(e.moreinfo=this.formatMoreInfoData(e.moreinfo),e.moreinfo=JSON.stringify(e.moreinfo)),"localhost"===e.domain&&(e.domain=""),e}},{key:"destory",value:function(){this.data=void 0,this.options=void 0,this.urlInterceptor=void 0,this.requestInterceptor=void 0}}]),t}(),V=new Array(15);function K(t,e){return 506832829*t>>>e}function Y(t,e){return t[e]+(t[e+1]<<8)+(t[e+2]<<16)+(t[e+3]<<24)}function F(t,e,r){return t[e]===t[r]&&t[e+1]===t[r+1]&&t[e+2]===t[r+2]&&t[e+3]===t[r+3]}function G(t,e,r,n,o){return r<=60?(n[o]=r-1<<2,o+=1):r<256?(n[o]=240,n[o+1]=r-1,o+=2):(n[o]=244,n[o+1]=r-1&255,n[o+2]=r-1>>>8,o+=3),function(t,e,r,n,o){for(var i=0;i<o;i++)r[n+i]=t[e+i]}(t,e,n,o,r),o+r}function W(t,e,r,n){return n<12&&r<2048?(t[e]=1+(n-4<<2)+(r>>>8<<5),t[e+1]=255&r,e+2):(t[e]=2+(n-1<<2),t[e+1]=255&r,t[e+2]=r>>>8,e+3)}function z(t,e,r,n){for(;n>=68;)e=W(t,e,r,64),n-=64;return n>64&&(e=W(t,e,r,60),n-=60),W(t,e,r,n)}function $(t,e,r,n,o){for(var i=1;1<<i<=r&&i<=14;)i+=1;var a=32-(i-=1);void 0===V[i]&&(V[i]=new Uint16Array(1<<i));for(var c=V[i],u=0;u<c.length;u++)c[u]=0;var s,f,l,p,d,h,v,y,g,m,b=e+r,w=e,k=e,_=!0;if(r>=15)for(s=b-15,l=K(Y(t,e+=1),a);_;){h=32,p=e;do{if(f=l,v=h>>>5,h+=1,p=(e=p)+v,e>s){_=!1;break}l=K(Y(t,p),a),d=w+c[f],c[f]=e-w}while(!F(t,e,d));if(!_)break;o=G(t,k,e-k,n,o);do{for(y=e,g=4;e+g<b&&t[e+g]===t[d+g];)g+=1;if(e+=g,o=z(n,o,y-d,g),k=e,e>=s){_=!1;break}c[K(Y(t,e-1),a)]=e-1-w,d=w+c[m=K(Y(t,e),a)],c[m]=e-w}while(F(t,e,d));if(!_)break;l=K(Y(t,e+=1),a)}return k<b&&(o=G(t,k,b-k,n,o)),o}var X=function(){function t(e){d(this,t),this.sources=e}return v(t,[{key:"maxCompressedLength",value:function(){var t=this.sources.length;return 32+t+Math.floor(t/6)}},{key:"compressToBuffer",value:function(t){var e,r=this.sources,n=r.length,o=0,i=0;for(i=function(t,e,r){do{e[r]=127&t,(t>>>=7)>0&&(e[r]+=128),r+=1}while(t>0);return r}(n,t,i);o<n;)i=$(r,o,e=Math.min(n-o,65536),t,i),o+=e;return i}}]),t}();function Q(t){return t instanceof Uint8Array}function Z(t){return t instanceof ArrayBuffer}function tt(t){if(!Q(t)&&!Z(t)&&(e=t,!Buffer.isBuffer(e)))throw new TypeError("Argument compressed must be type of ArrayBuffer, Buffer, or Uint8Array");var e,r,n=!1,o=!1;Q(t)?(n=!0,r=t):Z(t)&&(o=!0,r=new Uint8Array(t));var i,a,c,u=new X(r),s=u.maxCompressedLength();return n?(i=new Uint8Array(s),c=u.compressToBuffer(i)):o?(i=new ArrayBuffer(s),a=new Uint8Array(i),c=u.compressToBuffer(a)):(i=Buffer.alloc(s),c=u.compressToBuffer(i)),i.slice(0,c)}function et(t){return tt(function(t){for(var e=new Uint8Array(t.length),r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e.buffer}(t))}var rt=Math.pow(2,31)-1;function nt(t){return new Promise((function(e){var r=Number.isSafeInteger(t)&&t>0?t:0;setTimeout(e,r>rt?rt:r)}))}function ot(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=w(t);if(e){var o=w(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return b(this,r)}}var it=Object.assign({},H,{wait:"immediately"}),at=function(t){g(a,t);var e,r,n,o,i=ot(a);function a(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:it,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return d(this,a),(t=i.call(this,e,r)).trackingTasks=[],t.trackingReportors=[],t}return v(a,[{key:"report",value:(o=x(E.mark((function t(e){var r,n,o=arguments;return E.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=o.length>1&&void 0!==o[1]&&o[1],Array.isArray(e)){t.next=3;break}return t.abrupt("return",this.report([e],r));case 3:if(this.addTask.apply(this,O(e)),!r){t.next=7;break}return n=this.trackingTasks.pop(),t.abrupt("return",this.tryReport([n]));case 7:return t.abrupt("return",this.runReport());case 8:case"end":return t.stop()}}),t,this)}))),function(t){return o.apply(this,arguments)})},{key:"post",value:(n=x(E.mark((function t(){var e;return E.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!((e=this.freeTrackingTask()).length>0)){t.next=5;break}return this.tryReport(e),t.abrupt("continue",0);case 5:return t.abrupt("break",8);case 8:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"use",value:function(t,e){R(w(a.prototype),"use",this).call(this,t,e)}},{key:"addTask",value:function(){for(var t=this,e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];r.forEach((function(e){var r=t.processTrackingData(e),n=t.encodeTrackingData(r);if(t.validTrackingData(n)){var o={encoded:n,source:r};t.trackingTasks.push(o)}}))}},{key:"runReport",value:(r=x(E.mark((function t(){var e,r,n,o,i;return E.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=this.options,r=e.maxRequest,n=e.wait,!(this.trackingReportors.length>=r)){t.next=4;break}return t.next=4,Promise.all(this.trackingReportors);case 4:if(!a.supported){t.next=13;break}if("nextTick"!==n){t.next=10;break}return t.next=8,Promise.resolve();case 8:t.next=13;break;case 10:if("number"!=typeof n){t.next=13;break}return t.next=13,nt(n);case 13:if(!((o=this.freeTrackingTask()).length>0)){t.next=18;break}return i=this.tryReport(o),t.next=18,this.pushReport(i);case 18:case"end":return t.stop()}}),t,this)}))),function(){return r.apply(this,arguments)})},{key:"freeTrackingTask",value:function(){var t;if(null===(t=this.trackingTasks)||void 0===t||!t.length)return[];for(var e=1,r=0;r<this.trackingTasks.length;r++){if((e+=this.trackingTasks[r].encoded.length+3)>A)return this.trackingTasks.splice(0,r)}return this.trackingTasks.splice(0)}},{key:"tryReport",value:(e=x(E.mark((function t(e){var r,n,o,i,a,c,u,s,f=arguments;return E.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=f.length>1&&void 0!==f[1]?f[1]:0,t.prev=1,n=this.options,o=n.useHttps,i=n.domain,a="http".concat(!1!==o?"s":"","://").concat(i),t.next=6,this.delegateRequest(a,e);case 6:t.next=16;break;case 8:if(t.prev=8,t.t0=t.catch(1),c=this.options,u=c.useRetry,s=c.retryTimes,!(!0===u&&s>r)){t.next=15;break}return t.next=14,this.tryReport(e,r+1);case 14:return t.abrupt("return",t.sent);case 15:return t.abrupt("return",Promise.reject(t.t0));case 16:case"end":return t.stop()}}),t,this,[[1,8]])}))),function(t){return e.apply(this,arguments)})},{key:"pushReport",value:function(t){var e=this,r=function(){var r=e.trackingReportors.indexOf(t);e.trackingReportors.splice(r,1)},n=t.then(r).catch((function(t){return r(),Promise.reject(t)}));return this.trackingReportors.push(n),n}},{key:"delegateRequest",value:function(t,e){if(!Array.isArray(e)){var r=this.interceptUrl("".concat(t,"/").concat("n.gif"),e);return this.options.skipReport?Promise.resolve():this.send(r,e.encoded)}return 1===e.length?this.delegateRequest(t,e[0]):this.mergeRequest(t,e)}},{key:"mergeRequest",value:function(t,e){var r=e.map((function(t){return t.encoded})),n=this.compressTrackingDatas(r),o=this.interceptUrl("".concat(t,"/").concat("o.gif","?cmp=1&enc=b64"),e);return this.options.skipReport?Promise.resolve():this.send(o,n)}},{key:"interceptUrl",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.options;return"function"==typeof this.urlInterceptor?this.urlInterceptor(t,e,r):t}},{key:"compressTrackingDatas",value:function(t){var e=et(JSON.stringify(t)),r=String.fromCharCode.apply(null,new Uint8Array(e));return btoa(r)}},{key:"validTrackingData",value:function(t){return!(t.length>A)||(e=D,"function"==typeof(null===(r=console)||void 0===r?void 0:r.error)?console.error(e):"function"==typeof(null===(n=console)||void 0===n?void 0:n.log)&&console.log(e),!1);var e,r,n}},{key:"destory",value:function(){R(w(a.prototype),"destory",this).call(this),this.trackingTasks.splice(0),this.trackingReportors.splice(0),this.trackingTasks=void 0,this.trackingReportors=void 0}}]),a}(J);k(at,"supported","function"==typeof btoa&&"undefined"!=typeof Uint16Array);var ct=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"http request fail.",r=new Error(e),n=t.xhr,o={type:"ajax",response:null,event:t.event,data:t.data,xhr:n,status:n.status,responseText:n.responseText};try{o.response=JSON.parse(n.responseText)}catch(t){}return Object.assign(r,{detail:o})};function ut(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=w(t);if(e){var o=w(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return b(this,r)}}var st=function(t){g(r,t);var e=ut(r);function r(){return d(this,r),e.apply(this,arguments)}return v(r,[{key:"send",value:function(t,e){return function(t,e){return new Promise((function(r,n){var o=new XMLHttpRequest;o.open("POST",t),o.onerror=function(t){var r=ct({xhr:o,event:t,data:e});n(r)},o.onreadystatechange=function(t){if(o.readyState===XMLHttpRequest.DONE&&200===o.status)r();else{var i=ct({xhr:o,event:t,data:e});(o.status>=500||o.status>=402&&o.status<=420||400==o.status||401==o.status)&&n(i)}},o.setRequestHeader("Content-Type",j),o.withCredentials=!1,o.send(e)}))}(t,e)}}]),r}(at);k(st,"supported","undefined"!=typeof XMLHttpRequest);var ft,lt=function(){var t=x(E.mark((function t(e,r){var n,o,i,a;return E.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=new Blob([r],{type:j}),o={type:"beacon",url:e,body:n,data:r},t.prev=3,navigator.sendBeacon(e,n)){t.next=7;break}throw i=new Error("Send beacon fail."),Object.assign(i,{detail:o});case 7:t.next=13;break;case 9:throw t.prev=9,t.t0=t.catch(3),a=new Error("Send beacon fail."),Object.assign(a,{detail:o});case 13:case"end":return t.stop()}}),t,null,[[3,9]])})));return function(e,r){return t.apply(this,arguments)}}();function pt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=w(t);if(e){var o=w(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return b(this,r)}}var dt=function(t){g(r,t);var e=pt(r);function r(){return d(this,r),e.apply(this,arguments)}return v(r,[{key:"send",value:function(t,e){return lt(t,e)}}]),r}(at);function ht(t,e){var r=new dt(t,e),n=new st(t,e),o={httpInstance:n,beaconInstance:r};return dt.supported?Object.assign(r,o):st.supported?Object.assign(n,o):void 0}k(dt,"supported","function"==typeof(null===(ft=navigator)||void 0===ft?void 0:ft.sendBeacon));var vt,yt="shopline",gt="tracker_cid",mt="other_tracker_sid",bt="osudb_uid",wt={PRODUCT:"shop.eclytics.com",TEST:"debug.eclytics.com"},kt={wait:20,domain:wt.PRODUCT},_t="webslcodetrack",Ot="websdkprotocol",St="webmetricdata",xt="-999",Rt="1.9.3",Tt="106",Et=["app_id","version","project_id"],Pt=["event_id","event_name","page","module","component","action_type","event_created_at_ms"],It=["DEV","TEST","FAT","PRO"],jt="PRO",At=["env"],Dt=["device_token"],Ct=Object.freeze({__proto__:null,PROD_ID:yt,HTTP_COOKIE_KEY:gt,SESSION_ID_KEY:mt,UID_KEY:bt,STORE_ID_KEY:"store_id",DOMAIN:wt,TRACKER_OPTIONS:kt,APP_ID:"101",PROJECT_ID:"admintoC",ACT:_t,LEGACY_ACT:Ot,METRIC_ACT:St,DEFAULT_CODE:xt,SDK_VERSION:Rt,ACTION_TYPE_HEART:Tt,METRIC_PARAM_KEYS:Et,METRIC_EVENT_PARAM_KEYS:Pt,ENV_LIST:It,ENV_PRO:jt,REQUIRED_PARAM_KEYS:At,NOT_ENCODES_LIST:Dt}),Lt=new Uint8Array(16);function Mt(){if(!vt&&!(vt="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return vt(Lt)}var Ut=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Nt(t){return"string"==typeof t&&Ut.test(t)}for(var Bt=[],qt=0;qt<256;++qt)Bt.push((qt+256).toString(16).substr(1));function Ht(t,e,r){var n=(t=t||{}).random||(t.rng||Mt)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,e){r=r||0;for(var o=0;o<16;++o)e[r+o]=n[o];return e}return function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=(Bt[t[e+0]]+Bt[t[e+1]]+Bt[t[e+2]]+Bt[t[e+3]]+"-"+Bt[t[e+4]]+Bt[t[e+5]]+"-"+Bt[t[e+6]]+Bt[t[e+7]]+"-"+Bt[t[e+8]]+Bt[t[e+9]]+"-"+Bt[t[e+10]]+Bt[t[e+11]]+Bt[t[e+12]]+Bt[t[e+13]]+Bt[t[e+14]]+Bt[t[e+15]]).toLowerCase();if(!Nt(r))throw TypeError("Stringified UUID is invalid");return r}(n)}var Jt=T((function(t,e){var r;r=function(){function t(){for(var t=0,e={};t<arguments.length;t++){var r=arguments[t];for(var n in r)e[n]=r[n]}return e}function e(t){return t.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}return function r(n){function o(){}function i(e,r,i){if("undefined"!=typeof document){"number"==typeof(i=t({path:"/"},o.defaults,i)).expires&&(i.expires=new Date(1*new Date+864e5*i.expires)),i.expires=i.expires?i.expires.toUTCString():"";try{var a=JSON.stringify(r);/^[\{\[]/.test(a)&&(r=a)}catch(t){}r=n.write?n.write(r,e):encodeURIComponent(String(r)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),e=encodeURIComponent(String(e)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var c="";for(var u in i)i[u]&&(c+="; "+u,!0!==i[u]&&(c+="="+i[u].split(";")[0]));return document.cookie=e+"="+r+c}}function a(t,r){if("undefined"!=typeof document){for(var o={},i=document.cookie?document.cookie.split("; "):[],a=0;a<i.length;a++){var c=i[a].split("="),u=c.slice(1).join("=");r||'"'!==u.charAt(0)||(u=u.slice(1,-1));try{var s=e(c[0]);if(u=(n.read||n)(u,s)||e(u),r)try{u=JSON.parse(u)}catch(t){}if(o[s]=u,t===s)break}catch(t){}}return t?o[t]:o}}return o.set=i,o.get=function(t){return a(t,!1)},o.getJSON=function(t){return a(t,!0)},o.remove=function(e,r){i(e,"",t(r,{expires:-1}))},o.defaults={},o.withConverter=r,o}((function(){}))},t.exports=r()})),Vt=new(function(){function t(){a(this,t)}return u(t,[{key:"get",value:function(t){var e;try{var r=JSON.parse(localStorage.getItem(t)||"");r&&r.value&&(r.maxAge?r.maxAge>Date.now()?e=r.value:this.remove(t):e=r.value)}catch(t){}return e}},{key:"set",value:function(t,e,r){try{var n={value:e,maxAge:r?Date.now()+60*r*1e3:null};localStorage.setItem(t,JSON.stringify(n))}catch(t){}}},{key:"remove",value:function(t){localStorage.removeItem(t)}},{key:"getRaw",value:function(t){var e={value:null,maxAge:null};try{var r=JSON.parse(localStorage.getItem(t)||"");r&&r.value&&(e=r)}catch(t){}return e}},{key:"isExpired",value:function(t){try{var e=JSON.parse(localStorage.getItem(t)||"");return!e||!e.value||!(!e.maxAge||e.maxAge&&e.maxAge>Date.now())}catch(t){}return!0}},{key:"append",value:function(t,e){try{var r=JSON.parse(localStorage.getItem(t)||"");if(r&&r.value)return Object.assign(r.value,e),localStorage.setItem(t,JSON.stringify(r)),r.value}catch(t){}}}]),t}()),Kt=new(function(){function t(){a(this,t)}return u(t,[{key:"getHttpCookie",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=Vt.get(gt);return e||(e=Ht(),Vt.set(gt,e,t)),e}},{key:"getSessionId",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=Vt.getRaw(mt),n=Date.now(),o=r.value;o||(o={});var i=o.sid||"",a=r.maxAge&&r.maxAge<n,c=+o.ite;if(!o.sid||a){o={sid:Ht(),createAt:n,rn:1,last_session_id:i,session_create_type:101};var u=document,s=u.referrer;if(s){var f=window.location.host,l=new URL(s),p=l.host;p!==f&&(o.ref=s)}a&&(o.session_create_type=c?103:102)}var d=(new Date).setUTCHours(0,0,0,0);d<n&&(d+=864e5);var h=(d-n)/1e3/60,v=n+6e4*(new Date).getTimezoneOffset()+1e3*e,y=new Date(v+864e5).setHours(0,0,0,0)-v,g=y/1e3/60,m=Math.min(t,h,g);return o.ite=h<t||g<t?1:0,Vt.set(mt,o,m),o}},{key:"getSession",value:function(){return Vt.getRaw(mt)}},{key:"upsetSessionRn",value:function(t){var e=t.rn||1;return Vt.append(mt,{rn:e+1}),e}},{key:"getHttpSearch",value:function(){return window.location.search}},{key:"getUrlPath",value:function(){return window.location.pathname}},{key:"getMobile",value:function(){var t=navigator.userAgent,e=!t.match(/(iPad).*OS\s([\d_]+)/)&&t.match(/(iPhone\sOS)\s([\d_]+)/),r=t.match(/(Android)\s+([\d.]+)/);return e||r}},{key:"getIsMobile",value:function(){return this.getMobile()?"101":"102"}},{key:"getWebsite",value:function(){return this.getMobile()?"102":"101"}},{key:"getLanguage",value:function(){return navigator.language}},{key:"getUserId",value:function(){return Jt.get(bt)}},{key:"getTitle",value:function(){var t;return null===(t=document.title)||void 0===t?void 0:t.substr(0,255)}},{key:"getScreenWidth",value:function(){return window.screen.width}},{key:"getScreenHeight",value:function(){return window.screen.height}},{key:"getPerformance",value:function(){var t=window.performance||window.webkitPerformance,e={},r=t&&t.timing;if(t&&r){var n=0;window.chrome&&window.chrome.loadTimes&&(n=1e3*window.chrome.loadTimes().firstPaintTime,n-=r.navigationStart),e.dns=Math.ceil(r.domainLookupEnd-r.domainLookupStart),e.tcp=Math.ceil(r.connectEnd-r.connectStart),e.request=Math.ceil(r.responseEnd-r.requestStart),e.connect=Math.ceil(r.responseStart-r.domainLookupStart),e.processing=Math.ceil((r.domComplete||r.domLoading)-r.domLoading),e.ready=Math.ceil(r.domContentLoadedEventEnd-r.navigationStart),e.load=Math.ceil(r.loadEventEnd-r.navigationStart),e.white=Math.ceil(r.responseStart-r.navigationStart),e.first_paint=n,e.first_paint||(e.first_paint=r.domLoading>=r.navigationStart?r.domLoading-r.navigationStart:0),e.first_paint=Math.ceil(e.first_paint),e.active=Math.ceil(r.domInteractive-r.navigationStart)}return e}},{key:"getDomain",value:function(){return document.domain}}]),t}());function Yt(t,e){var r={};return e.forEach((function(e){Object.prototype.hasOwnProperty.call(t,e)&&(r["".concat(e)]=t[e])})),r}var Ft=["session_create_type","last_session_id"],Gt=function(){function t(){a(this,t),s(this,"debugMode",!1),s(this,"instance",void 0),s(this,"sendParams",null),s(this,"options",r(r({},kt),{},{timezoneOffset:0,env:""})),s(this,"interceptor",{})}var e,n,o;return u(t,[{key:"getBaseParams",value:(o=i(regeneratorRuntime.mark((function t(){var e,r,n,o,i,a,c;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=this.getOptions(),r=e.timezoneOffset,n=void 0===r?0:r,o=e.handleBaseParams,i=Kt.getSessionId(30,n),a=Kt.upsetSessionRn(i),c={version:Rt,http_cookie:Kt.getHttpCookie(),url_path:Kt.getUrlPath(),language:Kt.getLanguage(),is_mobile:Kt.getIsMobile(),user_id:Kt.getUserId(),http_search:Kt.getHttpSearch(),title:Kt.getTitle(),session_id:i.sid,session_create_time:i.createAt,session_rn:a,last_session_id:i.last_session_id,session_create_type:i.session_create_type,is_pc:Kt.getWebsite(),loading_time:Kt.getPerformance().load,event_created_at_ms:+new Date,screen_width:Kt.getScreenWidth(),screen_height:Kt.getScreenHeight(),http_domain:Kt.getDomain()},!o||"function"!=typeof o){t.next=7;break}return t.next=7,o(c);case 7:return t.abrupt("return",c);case 8:case"end":return t.stop()}}),t,this)}))),function(){return o.apply(this,arguments)})},{key:"checkParams",value:function(t){var e=!0,r=At.filter((function(e){return!t[e]}));return r.length&&(console.error("".concat(r," is necessary")),e=!1),It.includes(t.env)||(console.error("env is must be one of ".concat(It)),e=!1),e||console.error("tracking failure"),e}},{key:"reportMetric",value:function(e,n){var o=r(r({act:St,time:(new Date).getTime()},Yt(e,Et)),{},{events:Object.assign(Yt(e,Pt),{metric_value:1})}),i=t.encodeParams(o),a=t.encodeParams(o.events);if(i.events=JSON.stringify(a),!this.debugMode){var c=this.getInstance();return n?null==c?void 0:c.httpInstance.report(i,!0):null==c?void 0:c.report(i,!0)}}},{key:"setOptions",value:function(t){this.options=r(r({},this.options),t)}},{key:"getOptions",value:function(){return this.options}},{key:"setSendParams",value:function(t){this.sendParams=t}},{key:"setDebugMode",value:function(t){this.debugMode=t}},{key:"initInstance",value:function(){var t,e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=ht;return o&&o.default&&(o=o.default),o(r(r(r({},this.options),n),{},{domain:"".concat(null!==(t=null===(e=this.options)||void 0===e?void 0:e.customDomain)&&void 0!==t?t:window.location.host,"/eclytics")}))}},{key:"use",value:function(t,e){switch(t){case"url":case"request":this.interceptor[t]=e;break;default:this.instance?this._instanceUse(t,e):this.interceptor[t]=e}}},{key:"_instanceUse",value:function(t,e){var r=this;this.instance.use(t,e),["httpInstance","beaconInstance"].forEach((function(n){var o;null===(o=r.instance[n])||void 0===o||o.use(t,e)}))}},{key:"getInstance",value:function(){var t=this;if(!this.instance){this.instance=this.initInstance();var e=Ht();this._instanceUse("url",(function(n,o,i){var a=t.getOptions().queryParams,c=void 0===a?{}:a,u=t.sendParams;"function"==typeof t.interceptor.url&&(n=t.interceptor.url(n,o,i));var s,f,p=Kt.getSession().value;if(p&&p.sid){var d=p.sid,h=p.createAt,v=[].concat(o),y=function(t){var e=0;return(t=[].concat(t))&&t.length&&(e=t.some((function(t){var e,r,n;return"101"==(null===(e=t.source)||void 0===e||null===(r=e.moreinfo)||void 0===r?void 0:r.event_name)&&"60006253"==(null===(n=t.source)||void 0===n?void 0:n.eventid)}))),Number(e)}(v),g=r({_sid:d,_sct:h,_tid:e,_pdppv:y,_bcount:v.length},"function"==typeof c?c(u):c);return"".concat(n).concat(-1===n.indexOf("?")?"?":"&").concat((s=g,(f=Object.entries(s)).reduce((function(t,e,r){var n=l(e,2),o=n[0],i=n[1];return t+"".concat(o,"=").concat(i).concat(r!==f.length-1?"&":"")}),"")))}return n})),this._instanceUse("request",(function(t){if(t.act!==_t)return t;var e=r(r({},t),{},{event_sent_at_ms:t.request_time});return delete e.request_time,e})),Object.keys(this.interceptor).filter((function(t){return!/(url|request)/.test(t)})).forEach((function(e){"function"==typeof t.interceptor[e]&&t._instanceUse(e,t.interceptor[e])}))}return this.instance}},{key:"reportHeart",value:(n=i(regeneratorRuntime.mark((function t(){var e,n=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=n.length>0&&void 0!==n[0]?n[0]:{action_type:Tt,env:jt},t.abrupt("return",this.report(r(r({},e),{},{action_type:Tt})));case 2:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"report",value:(e=i(regeneratorRuntime.mark((function e(n,o){var i,a,c,u,s,f,l,p,d,h,v,y,g,m,b,w,k,_,O,S,x,R,T;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,p=this.getOptions(),d=p.beforeSend,h=p.onSessionUpdate,e.next=4,this.getBaseParams();case 4:if(v=e.sent,y=r(r(r({},v),n),{},{act:null!==(i=n.act)&&void 0!==i?i:_t,action_type:null!==(a=n.action_type)&&void 0!==a?a:xt,module:null!==(c=n.module)&&void 0!==c?c:xt,page:null!==(u=n.page)&&void 0!==u?u:xt,component:null!==(s=n.component)&&void 0!==s?s:xt,env:null!==(f=n.env)&&void 0!==f?f:jt}),this.setSendParams(y),!d||"function"!=typeof d){e.next=11;break}return e.next=10,d(y);case 10:y=e.sent;case 11:if(this.checkParams(y)){e.next=14;break}return e.abrupt("return");case 14:if(!Vt.isExpired(mt)||"function"!=typeof h){e.next=25;break}return m=(null===(g=Vt.getRaw(mt))||void 0===g?void 0:g.value)||null,b=Kt.getSessionId(),e.prev=17,e.next=20,h(m,b);case 20:e.next=25;break;case 22:e.prev=22,e.t0=e.catch(17),console.error(e.t0);case 25:if(k=(w=o||{}).immediately,_=w.isHttpReport,O=w.reportNow,S=this.getInstance(),x=t.encodeParams(y),R=t.encodeParams(null!==(l=y.moreinfo)&&void 0!==l?l:{}),x.moreinfo=R,!this.debugMode){e.next=36;break}return console.groupCollapsed("Tracker Debug(reportV2):Wait Mode:".concat(this.options.wait,".event_id:").concat(y.event_id," immediately:").concat(!!k," isHttpReport:").concat(!!_," reportNow:").concat(!!O)),console.table(y),console.table(x),console.groupEnd(),e.abrupt("return");case 36:return T=_?null==S?void 0:S.httpInstance.report(x,O):null==S?void 0:S.report(x,O),k&&S.post(),e.abrupt("return",T);case 41:throw e.prev=41,e.t1=e.catch(0),console.log("collect tracker error:",e.t1),e.t1;case 45:case"end":return e.stop()}}),e,this,[[0,41],[17,22]])}))),function(t,r){return e.apply(this,arguments)})},{key:"reportJudge",value:function(e,r,n,o,i){if(this.debugMode&&(console.groupCollapsed("Tracker Debug:".concat(e,"-").concat(r.event_name,". Wait Mode:").concat(this.options.wait,". immediately:").concat(n)),console.table(r),console.groupEnd()),"product"===this.options.env){var a=t.encodeParams(r),c=this.getInstance(),u=a.session_create_type,s=a.last_session_id,l=f(a,Ft),p={prodid:yt,eventid:e,ref:document.referrer,act:Ot,session_create_type:u,last_session_id:s,moreinfo:l},d=o?null==c?void 0:c.httpInstance.report(p,i):null==c?void 0:c.report(p,i);return n&&c.post(),d}return Promise.resolve()}}]),t}();s(Gt,"encodeParams",(function(t){return Object.keys(t).reduce((function(e,r){try{e[r]=Dt.includes(r)?t[r]:encodeURIComponent(t[r]||"")}catch(n){console.log("[tracker] encodeURIComponent params error:",n),e[r]=t[r]}return e}),{})}));var Wt=new Gt;t.SDK_VERSION="1.9.3",t.Tracker=Gt,t.baseParams=Kt,t.constants=Ct,t.storage=Vt,t.tracker=Wt,Object.defineProperty(t,"__esModule",{value:!0})}));
